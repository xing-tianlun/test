```js
<template>
  <div class="main-subject detail-account-box">
    <div class="detail_account_head"  v-show="isSearchShow">
      <account-book-popup
        ref="accountBook"
        :period-data="periodData"
        :refresh-page="refreshPage"
        :period-data-old="periodDataOld"
        :account-id="accountParams.accountId"
        :code-name-props="codeNameProps"
        :popupType="popupType"
        :subject-options="subjectOptions"
        :disabledDateObj="disabledDateObj"
        @search-list="searchList"
        v-clickoutside="handleClose"
      />
    </div>
    <!-- <div class="main-top"> -->
    <!-- <div class="dateSubject">
        <div class="inputBox" @click.stop="datePeriod">
          {{periodContent}}
          <i></i>
        </div>

        <em class="el-icon-refresh-salf" @click="refreshClick" circle></em>
      </div> -->
    <!-- </div> -->
    <div class="main-content customer-box sumBalance_content">
      <div class="main-top top">
        <el-col :span="14">
          <el-form
            :label-position="labelPosition"
            :inline="true"
            :model="formTiem"
            ref="formTiem"
          >
          <button @click="btn">
            btn
          </button>
             <el-date-picker
              v-model="formTiem.dateRange"
              type="monthrange"
              align="right"
              :picker-options="disabledDateObj"
              start-placeholder="开始日期"
              end-placeholder="结束日期"
              style="width: 180px !important"
              v-show="!isSearchShow"
              @change="limit_search"

            ></el-date-picker>
            <el-button
              v-show="!isSearchShow"
              class="btn-main btn-wide-padding btn__add"
              @click="clickSearch"
              >搜索</el-button
            >
            <el-button class="btn__default" @click="packUp">{{
                this.isSearchShow ? "收起" : "更多查询"
              }}</el-button>

          </el-form>
        </el-col>
        <el-col :span="10">
          <div class="btn-group">
            <el-button
              class="btn btn-main btn-auto"
              @click="currentYearShowClick"
              >{{ currentYearName }}</el-button
            >
            <el-button class="btn__default" @click="printBtn">打印</el-button>
            <!-- <el-button class="btn__default" @click="exportBtn">导出</el-button> -->
            <el-button class="btn__default" @click="batchExportBtn"
              >导出</el-button
            >
          </div>
        </el-col>
      </div>

      <div class="detail_account_main">
        <div class="table-main table-main-balance table-main-cell">
          <el-col :span="1">
            <date-selection
              ref="dateSelection"
              :date="timeInterval"
              @getDate="selectDateGetList"
            />
          </el-col>
          <el-col :span="23">
            <el-table
              border
              height="'100%'"
              class="periodTable"
              ref="mainTable"
              :stripe="true"
              :data="detailAccountList"
              highlight-current-row
              emptyText="暂无数据"
            >
              <el-table-column
                min-width="12%"
                align="left"
                prop="date"
                label="日期"
              >
              </el-table-column>
              <el-table-column min-width="15%" align="left" label="科目">
                <template slot-scope="scope">
                  <div>
                    {{ scope.row.accountCode}} {{ scope.row.accountFullName}}
                  </div>
                </template>
              </el-table-column>
              <el-table-column min-width="8%" align="left" label="凭证字号">
                <template slot-scope="scope">
                  <div class="active" @click="voucherEdit(scope.row.voucherId)">
                    <span v-if="scope.row.voucherNumber ? true : false">记-</span
                    >{{ scope.row.voucherNumber }}
                  </div>
                </template>
              </el-table-column>
              <el-table-column
                min-width="14%"
                align="left"
                prop="digest"
                label="摘要"
              >
              </el-table-column>
              <el-table-column
                min-width="13%"
                align="right"
                style=" float: right !important; "
                prop="debitAmount"
                label="借方"
              >
              </el-table-column>
              <el-table-column
                min-width="13%"
                align="right"
                prop="creditAmount"
                label="贷方"
              >
              </el-table-column>
              <el-table-column min-width="8%" align="left" label="方向">
                <template slot-scope="scope">
                  <span
                    v-html="
                      scope.row.balance === ''
                        ? '平'
                        : scope.row.direction === 0
                        ? '贷'
                        : '借'
                    "
                  ></span>
                </template>
              </el-table-column>
              <el-table-column
                min-width="12%"
                align="right"
                prop="balance"
                label="余额"
              >
              </el-table-column>
            </el-table>
             <div class="page-box" style="margin-bottom: 0!important">
              <v-pagination
                :pageSize="pageObj.pageSize"
                :total="total"
                :currentPage="pageObj.pageNum"
                @change-page-size="changePageSize"
                @change-page="changePage"/>
            </div>
          </el-col>
        </div>

        <div class="subject-content">
          <div class="subject-header">
            <p>
              科目：<span>{{ subjectCodeName }}</span>
            </p>
            <el-input
              class="subject-input"
              v-model.trim="subjectInput"
              placeholder="请输入科目编码、名称或者助记码"
            >
            </el-input>
          </div>
          <ul class="subject-item">
            <li
              v-for="(item, key) in subjectArray"
              :key="key"
              :title="`${item.code} ${item.fullName}` "
              :class="{ active: selectIndex === item.id }"
              @click="clickSubject(item, key)"
            >
              {{ `${item.code} ${item.fullName}` }}
            </li>
          </ul>
        </div>
      </div>
    </div>
    <batch-export-com
      ref="batchExport"
      v-if="batchExportShow"
      :queryParam="accountParams"
      :period-data-old="periodDataOld"
      :periodDate="formTiem.dateRange"
      :disabledDateObj="disabledDateObj"
      @submit-data="submitBatchBtn"
      @close-model="closeModel"
    />
  </div>
</template>

<script>
import { mapGetters } from "vuex";
import { printExport } from "@/api/axios.config";
import accountBook from "@/api/accountBook/accountBook";
import accountBookPopup from "@/components/accountBook/accountBook";
import dateSelection from "@/components/dateSelection/dateSelection";
import batchExportCom from "./exportDetailAccount";
import vPagination from '@/components/Pagination/Pagination'
import { clickoutside, getLastDay } from "@/tools/tools";

export default {
  name: "detailAccount",
  props: {
    refreshPage: {
      type: String,
      default: "",
    },
  },
  data() {
    return {
      detailAccountList: [],
      accountBookPopupShow: false,
      batchExportShow: false,
      selectIndex: 0,
      accountParams: {
        keyWord: "",
        accountId: 0,
        start: "",
        end: "",
        startLevel: 1,
        endLevel: 5,
        showZeroNoOccur: false,
      },
      periodData: {},
      periodDataOld: {}, // 控制期间的选择范围以及对期间进行重置
      periodDataDef: "", // 默认期间的最大值
      periodDataSch: {
        start: "",
        end: "",
      }, // 搜索期间对象
      periodContent: "",
      flag: false,
      subjectInput: "",
      subjectArray: [],
      searchSubjectArray: [],
      subjectCodeName: "",
      currentPeriodObj: {
        startCurren: "",
        endCurren: "",
      },
      codeNameProps: {},
      clickSubjectId: "",
      clickSubjectIdFlag: "",
      detailFlag: "",
      labelPosition: "right",
      formTiem:{
        dateRange: new Date(),
        start: new Date(),
        end: new Date(),
      },
      popupType:'more',
      getPeriodObj: null, // 获取当前期间返回的数据props子组件（筛选）
      disabledDateObj:null,
      isSearchShow: false,
      currentYearShow: true,
      hasYear: 1,
      currentYearName: "隐藏本年累计",
      detailAccountListShow: [],
      detailAccountListHide: [],
      timeInterval:{
        start:null,
        end:null,
      },
      pageObj: {
        pageSize: 200,
        pageNum: 1
      },
      total: 0,
      subjectOptions:[],
      searchAll:{},
      count:0
    };
  },
  directives: { clickoutside },
  computed: {
    ...mapGetters(["formatDate", "formatInt", "getOrder"]),
  },
  created() {
    // this.getPeriod();
    this.periodListFn("load");
    this.querySubjectList();
  },
  mounted() {
    if (
      this.$router.currentRoute.query &&
      this.$router.currentRoute.query.subjectId
    ) {
      setTimeout(() => {
        this.clickSubjectIdFlag = "clickSubjcet";
        this.subjectCodeName =
          this.$router.currentRoute.query.code +
          " " +
          this.$router.currentRoute.query.fullName;
        this.$refs.accountBook.setSubjectCode(this.$router.currentRoute.query.code)
        this.accountParams.endAccountCode = this.$router.currentRoute.query.code;
        this.accountParams.startAccountCode = this.$router.currentRoute.query.code;
        this.accountParams.accountId = Number(
          this.$router.currentRoute.query.subjectId
        ); // 获取对应id
        this.selectIndex = this.$router.currentRoute.query.subjectId; // 动态class
        let date = this.$router.currentRoute.query.date;
        this.accountParams.start = date;
        this.accountParams.end = date;
        this.periodContent = date.slice(0, 7).split("-").join("年") + "期";
        this.currentPeriodObj.startCurren = date;
        this.currentPeriodObj.endCurren = date;
        this.detailAccountInit(this.accountParams); // 列表
        console.log(123456);
      }, 100);
    }
  },
  methods: {
    btn() {
      console.log(111);
      this.$set(this.formTiem,'dateRange', [new Date('2022-02'), new Date('2022-02')])
    },
    querySubjectList(val) {
      // 科目新增检查
      accountBook.SubjectList(val).then(res => {
        if (res.code === 200) {
          this.subjectOptions = res.data.map(item => {
            item.codeName = `${item.code} ${item.name}`;
            return item;
          });
        }
      });
    },
    changePageSize (pageSize) { // 改变数量
      this.pageObj.pageSize = pageSize
      this.pageObj.pageNum = 1
      this.subjectList()

      // 更改分页信息将table 位置变为 0
      sessionStorage.setItem('DetailAccountPagePosition', 0)
      this.$nextTick(() => {
        this.$refs.mainTable.bodyWrapper.scrollTop = 0
      })
    },
    changePage (pageSize, pageNumber) { // 页码
      this.pageObj.pageNum = pageNumber
      this.subjectList()

      // 更改分页信息将table 位置变为 0
      sessionStorage.setItem('DetailAccountPagePosition', 0)
      this.$nextTick(() => {
        this.$refs.mainTable.bodyWrapper.scrollTop = 0
      })
    },
    limit_search(val){
      console.log(val);
      this.$set(this.formTiem.dateRange, new Date());
    },
    selectDateGetList(date) {
      this.accountParams.start = date+'-01';
      this.accountParams.end = date+'-01';
      this.formTiem.dateRange = [date+'-01',date+'-01']
      sessionStorage.setItem('DetailAccountPageSearch', JSON.stringify(
        {
          start:this.accountParams.start = date+'-01',
          end: this.accountParams.end = date+'-01'
        }
      ))
      console.log(22222);
      sessionStorage.setItem('DetailAccountPagePosition', 0)
      this.$refs.accountBook.changeData(this.formTiem.dateRange)
      this.subjectList()
    },
    currentYearShowClick() {
      this.currentYearShow = !this.currentYearShow;
      if (this.detailAccountList.length > 0) {
        this.$nextTick(() => {
          this.$refs.mainTable.bodyWrapper.style.height = "auto";
        });
      }
      if (this.currentYearShow === true) {
        this.currentYearName = "隐藏本年累计";
        this.hasYear = 1;
        this.detailAccountList = [...this.detailAccountListShow]
      } else {
        this.currentYearName = "显示本年累计";
        this.hasYear = 0;
        this.detailAccountList = [...this.detailAccountListHide]
      }
    },
    // 更多查询
    packUp() {
      this.isSearchShow = !this.isSearchShow;
    },
    clickSearch() {
      this.$nextTick(() => {
        this.$refs.mainTable.bodyWrapper.scrollTop = 0
      })

      if (
        this.formTiem.dateRange.length !== undefined &&
        this.formTiem.dateRange.length > 1
      ) {
        this.formTiem.start = this.formatDate(this.formTiem.dateRange[0]);
        this.formTiem.end = this.formatDate(this.formTiem.dateRange[1]);
      } else {
        this.formTiem.start = new Date();
        this.formTiem.end = new Date();
      }

      let startTime = new Date(this.formTiem.start).getTime(); // 获取开始毫秒数
      let endTime = new Date(this.formTiem.end).getTime(); // 获取结束毫秒数
      if (startTime > endTime) {
        this.$message({
          message: "提示：截止期间小于起始期间，请重新输入！",
          type: "error",
        });
      }
      // if (this.formTiem.start && this.formTiem.end) {
      //   this.formTiem.start = this.formatDate(new Date(this.formTiem.start));
      //   this.formTiem.end = this.formatDate(new Date(this.formTiem.end));
      // } else {
      //   this.formTiem.start = this.formatDate(
      //     new Date(this.defaultPeriod.start)
      //   );
      //   this.formTiem.end = this.formatDate(
      //     new Date(this.defaultPeriod.start)
      //   );
      // }
      this.$refs.dateSelection.uncheck();
      this.$refs.accountBook.changeData(this.formTiem.dateRange)
      // sessionStorage.setItem('DetailAccountPageSearch', JSON.stringify(query))
      console.log(this.formTiem, 'fortime');
      // ++++++++++++++
      // this.detailAccountInit(this.formTiem)
      this.searchList(this.formTiem);
      // this.$refs.pqShow.resetForm();
    },
    getPeriod() { 
        // 获取期间接口数据
      accountBook.QueryAccountPeriod().then((res) => {
        if (res.code === 200) {
          let end = this.getDateNow()
          this.getPeriodObj = res.data;
          this.formTiem.dateRange = [this.formatLastDate(res.data.currentPeriod),this.formatLastDate(res.data.currentPeriod)];
          this.disabledDateObj = {
            disabledDate(time) {
              return (
                time.getTime() < new Date(res.data.start).getTime()-86400000 ||
                time.getTime() >= new Date(end).getTime()
              );
            }
          };
          this.timeInterval.end = end;
          this.timeInterval.start = res.data.start;
          this.timeInterval.dateRange = this.formTiem.dateRange;
          this.$refs.accountBook.changeData(this.formTiem.dateRange)
          this.$refs.dateSelection.getDate(this.timeInterval)
        }
      });
    },
    formatLastDate(date) {
      // 格式化日期
      let year = date.slice(0, 4);
      let month = date.slice(5, 7);
      let day = getLastDay(year, month);
      return year + "-" + month + "-" + day;
    },
    getDateNow(){
      var d = new Date();
      var y = d.getFullYear()
      var m = d.getMonth() +1
      var r = d.getDate()
      var data = y + "-" + (m < 10 ? "0" + m : m) + "-" + (r < 10 ? "0" + r : r)
      return data
    },
    routerAccountFn(data) {
      if (this.$route.params.period.start) {
        this.accountParams.start = data.period.start;
        this.accountParams.end = data.period.end;
      } else {
        this.periodContent =
          data.period.start.slice(0, 7).split("-").join("年") + "期";
      }
      this.accountParams.accountId = data.accountId;
      this.selectIndex = data.accountId;
      this.clickSubjectIdFlag = "clickSubjcet";
      this.subjectCodeName = data.codeName;
      this.currentPeriodObj.startCurren = data.period.start;
      this.currentPeriodObj.endCurren = data.period.end;
      this.periodData = this.currentPeriodObj;
      this.periodData.currenFlag = true;
    },
    periodListFn(type) {
      console.log('qijian');
      // 获取期间接口
      accountBook.QueryAccountPeriod().then((res) => {
        if (res.code === 200) {
          this.periodDataOld = res.data;
          if (sessionStorage.listStatus) {
            let newStatus = JSON.parse(sessionStorage.listStatus);
            if (
              newStatus.detailAccount === 1 ||
              newStatus.detailAccount === "1"
            ) {
              newStatus.detailAccount = 0;
              sessionStorage.setItem("listStatus", JSON.stringify(newStatus));
            }
          }
          if (type === "load") {
            if (this.$route.params && this.$route.params.period) {
              // 从科目余额和科目汇总跳转过来的
              this.$refs.accountBook.setSubjectCode(this.$route.params.code)
              this.accountParams.endAccountCode = this.$route.params.code;
              this.accountParams.startAccountCode = this.$route.params.code;
              this.formatPeriod(this.$route.params.period);
              this.accountParams.start = this.$route.params.period.start;
              this.accountParams.end = this.$route.params.period.end;
              this.routerAccountFn(this.$route.params);
            } else {
              this.periodContent =
                res.data.currentPeriod.slice(0, 7).split("-").join("年") + "期";
              this.accountParams.start = res.data.currentPeriod;
              this.accountParams.end = res.data.currentPeriod;
              this.periodDataSch.start = res.data.currentPeriod;
              this.periodDataSch.end = res.data.currentPeriod;
            }
            this.currentPeriodObj.startCurren = res.data.currentPeriod;
            this.currentPeriodObj.endCurren = res.data.currentPeriod;
            this.periodData = this.currentPeriodObj;
            this.periodData.currenFlag = true;
            this.periodData.showZeroNoOccur = this.accountParams.showZeroNoOccur;
            this.periodDataDef = res.data.maxVoucherPeriod;
          } else {
            if (this.$route.params && this.$route.params.period) {
              // 从科目余额和科目汇总跳转过来的
              this.formatPeriod(this.$route.params.period);
              this.accountParams.start = this.$route.params.period.start;
              this.accountParams.end = this.$route.params.period.end;
              this.routerAccountFn(this.$route.params);
            } else {
              if (this.periodDataSch.end) {
                if (this.periodDataSch.end <= res.data.end) {
                  this.accountParams.start = this.periodDataSch.start;
                  this.accountParams.end = this.periodDataSch.end;
                } else {
                  let formatStart = res.data.currentPeriod
                    .slice(0, 7)
                    .split("-")
                    .join("年");
                  this.periodContent = `${formatStart}期`;
                  this.accountParams.end = res.data.currentPeriod;
                }
              } else {
                if (this.periodDataDef > res.data.maxVoucherPeriod) {
                  let formatStart = res.data.currentPeriod
                    .slice(0, 7)
                    .split("-")
                    .join("年");
                  this.periodContent = `${formatStart}期`;
                  this.accountParams.end = res.data.currentPeriod;
                }
              }
            }
            if(this.count === 0) {
              sessionStorage.setItem('DetailAccountPageSearch', JSON.stringify(data))
              this.count++
            }else {
              let getDetailAccountPageSearch = sessionStorage.getItem('DetailAccountPageSearch');
              let tempData = JSON.parse(getDetailAccountPageSearch);
      this.searchList(tempData, this.codeNameProps);
      console.log(tempData, 'tempData');
      this.$nextTick(() => {
        this.$set(this.formTiem,'dateRange', [new Date('2022-02'), new Date('2022-02')])
      })

      this.$set(this.formTiem,"start", tempData.start);
      this.$set(this.formTiem, "end", tempData.end);
              console.log(this.formTiem);
            }
          }
          let end = this.getDateNow()
          this.getPeriodObj = res.data;
          if(this.$router.currentRoute.params.period && this.$router.currentRoute.name == 'detailAccount' && this.$router.currentRoute.params.period.start&& this.$router.currentRoute.params.period.end){
            this.formTiem.dateRange = [this.$router.currentRoute.params.period.start,this.$router.currentRoute.params.period.end];
          }else {
            this.formTiem.dateRange = [this.formatLastDate(res.data.currentPeriod),this.formatLastDate(res.data.currentPeriod)];
          }
          this.$refs.accountBook.changeData(this.formTiem.dateRange)
          this.disabledDateObj = {
            disabledDate(time) {
              return (
                time.getTime() < new Date(res.data.start).getTime()-86400000 ||
                time.getTime() >= new Date(end).getTime()
              );
            }
          };
          this.timeInterval.end = end;
          this.timeInterval.start = res.data.start;
          let startDate  = this.formTiem.dateRange[0].split("-");
          let endDate = this.formTiem.dateRange[1].split("-");
          if((startDate[0] == endDate[0])&&(startDate[1] == endDate[1])){
            this.timeInterval.dateRange = this.formTiem.dateRange;
            this.$refs.dateSelection.getDate(this.timeInterval)
          }else {
            this.timeInterval.dateRange = this.formTiem.dateRange;
            this.$refs.dateSelection.uncheck();
          }
          this.subjectList();
        }
      });
    },
    subjectList(val) {
      console.log(12);
      // 右侧科目列表
      accountBook.subjectList({...this.accountParams}).then((res) => {
        if (res.code === 200) {
          this.subjectArray = res.data; // 展示数据
          this.searchSubjectArray = res.data; // 模糊查询数据
          this.accountBookPopupShow = false; // 关闭弹框
          if (res.data.length > 0) {
            // 筛选条件不存在右侧选中的科目时，选中右侧科目列表的第一个
            let isSelectSubjectId = this.subjectArray.some((item) => {
              return item.id === this.selectIndex;
            });
            if (!this.clickSubjectIdFlag || !isSelectSubjectId) {
              // this.subjectCodeName = res.data[0].code + ' ' + res.data[0].fullName // 科目：默认选中第一个
              // this.accountParams.accountId = res.data[0].id // 明细账列表默认第一个科目id
              // this.selectIndex = res.data[0].id
              if (this.$router.currentRoute.query.subjectId) {
                this.subjectCodeName =
                  this.$router.currentRoute.query.code +
                  " " +
                  this.$router.currentRoute.query.name;
                this.$refs.accountBook.setSubjectCode(this.$router.currentRoute.query.code)
                this.accountParams.accountId = Number(
                  this.$router.currentRoute.query.subjectId
                ); // 获取对应id
                this.accountParams.start = this.$router.currentRoute.query.date;
                this.accountParams.end = this.$router.currentRoute.query.date;
                this.formTiem.dateRange = [this.accountParams.start,this.accountParams.end];
                this.$refs.accountBook.changeData(this.formTiem.dateRange)
                this.$refs.dateSelection.uncheck();
                this.selectIndex = Number(
                  this.$router.currentRoute.query.subjectId
                );
              } else {
                this.subjectCodeName =
                  res.data[0].code + " " + res.data[0].fullName; // 科目：默认选中第一个
                  if(val != 'seach'){
                    this.$refs.accountBook.setSubjectCode(res.data[0].code)
                  }
                this.accountParams.accountId = res.data[0].id; // 明细账列表默认第一个科目id
                this.selectIndex = res.data[0].id;
              }
              console.log(3);
              this.detailAccountInit(this.accountParams); // 明细账列表
            } else {
              this.detailAccountInit(this.accountParams);
            }
          } else {
            this.detailAccountList = [];
            this.subjectCodeName = "";
            // this.$refs.accountBook.setSubjectCode('')
          }
        }
      });
    },
    detailAccountInit(data) {
      console.log(data, 'data');
      let tempData = {}
      console.log(this.count, 'befor count');
      if(this.count === 0) {
        sessionStorage.setItem('DetailAccountPageSearch', JSON.stringify(data))
        console.log(44444);
        this.count++
      }else {
        console.log(sessionStorage.getItem('DetailAccountPageSearch'),'DetailAccountPageSearch');
        let getDetailAccountPageSearch = sessionStorage.getItem('DetailAccountPageSearch');
        tempData = JSON.parse(getDetailAccountPageSearch);
        
      }
      console.log(1234567890987654);
      // this.$nextTick(() => {
          this.$set(this.formTiem, 'dateRange', [new Date(tempData.start), new Date(tempData.end)])
        // })
      console.log(this.count, 'count');
      console.log({...tempData});
      let query = {...tempData}
      delete query.dateRange
      delete query.accountId
      // 明细账列表
      accountBook.dedailAccountListTree({...query,...this.pageObj}).then((res) => {
        if (res.code === 200) {
          this.formatInt(res.data.itemsPage.list);
          let data = [...res.data.itemsPage.list],newData = [];
          this.total = res.data.itemsPage.total;
          data.map((item,index)=>{
            if(item.digest !== '本年累计'){
              newData.push(item)
            }
          })
          this.detailAccountListShow = res.data.items;
          this.detailAccountListHide = newData;
          this.detailAccountList = res.data.itemsPage.list; // 展示数据
          this.accountBookPopupShow = false;
        } else if (res.code === 400) {
          this.$message({
            message: `提示：${res.message}`,
            type: "error",
          });
        }
      });
    },
    voucherEdit(data) {
      sessionStorage.setItem('DetailAccountPagePosition', this.$refs.mainTable.bodyWrapper.scrollTop)

      // 点击凭证字号跳到凭证录入详情
      if (data) {
        this.$store.commit("VOUCHER_INPUT", data);
        sessionStorage.setItem("voucherId", data);
        this.$router.push({
          name: "voucherInfo",
          params: { voucherId: data, isEdit: true },
        });
      }
    },
    refreshClick() {
      // 刷新列表
      if (this.accountParams.accountId !== 0) {
        this.detailAccountInit(this.accountParams);
      }
    },
    clickSubject(item, index) {
      // 点击科目刷新列表
      if(!item){
        item =  this.subjectArray[0]
      }
      this.clickSubjectIdFlag = "clickSubjcet";
      this.accountParams.accountId = item.id; // 获取对应id
      this.subjectCodeName = item.code + " " + item.fullName;
      this.$refs.accountBook.setSubjectCode(item.code)
      this.selectIndex = item.id; // 动态class
      this.accountParams.startAccountCode = item.code;
      this.accountParams.endAccountCode = item.code;
      this.detailAccountInit(this.accountParams); // 列表
      document.querySelector(
        ".detail-account-box .el-table__body-wrapper"
      ).scrollTop = 0; // 搜索设置滚动条距离
    },
    formatPeriod(data) {
      var dateReg = /^(\d{4})-(\d{2})-(\d{2})$/;
      if (dateReg.test(data.start)) {
      } else {
        data.start = this.formatDate(data.start);
        data.end = this.formatDate(data.start);
      }
      // 期间格式化
      let formatStart = data.start.slice(0, 7).split("-").join("年");
      let formatEnd = data.end.slice(0, 7).split("-").join("年");
      if (formatStart === formatEnd) {
        this.periodContent = `${formatStart}期`;
      } else {
        this.periodContent = `${formatStart}期 至 ${formatEnd}期`;
      }
      this.currentPeriodObj.startCurren = data.start;
      this.currentPeriodObj.endCurren = data.end;
    },
    searchList(query, codeNameData) {
      console.log(query, codeNameData);
      sessionStorage.setItem('DetailAccountPageSearch', JSON.stringify(query))
      console.log(33333);

      let data = {...query, ...codeNameData}
      delete data.dateRange;
      // 根据期间相关搜索
      this.formTiem.dateRange = query.dateRange;
      this.$refs.accountBook.changeData(this.formTiem.dateRange)
      this.periodDataSch.start = data.start;
      this.periodDataSch.end = data.end;
      this.accountParams.start = this.formatDate(data.start);
      this.accountParams.end = this.formatDate(data.end);
      this.accountParams = data; // 获取数据
      this.formatPeriod(data); // 格式化期间
      this.subjectList('seach'); // 右侧科目列表
      this.codeNameProps = codeNameData; // 级次数据
      this.accountBookPopupShow = false;
      this.$refs.dateSelection.uncheck();
      // this.detailAccountInit(data)
      document.querySelector(
        ".detail-account-box .el-table__body-wrapper"
      ).scrollTop = 0; // 搜索设置滚动条距离
    },
    datePeriod() {
      // 期间弹框
      this.accountBookPopupShow = !this.accountBookPopupShow;
    },
    printBtn() {
      console.log(this.accountParams);
      let query = {...this.accountParams};
      delete query.startAccountCode;
      delete query.endAccountCode;
      delete query.dateRange;
      // 打印
      printExport(
        "/account-book/export-subsidiary-ledger",
        "print-pdf",
        "",
        query
      );
    },
    exportBtn() {
      let query = {...this.accountParams};
      // delete query.startAccountCode;
      // delete query.endAccountCode;
      // delete query.dateRange;
      // // 导出
      printExport(
        "/account-book/export-subsidiary-ledger",
        "excel",
        "",
        query
      );
    },
    batchExportBtn() {
      // 批量导出弹框
      this.batchExportShow = true;
    },
    submitBatchBtn(data, formatType, uploadType) {
      let period = {...this.accountParams};
      this.formatDate(new Date(this.formTiem.start))
      period.startPeriod = this.formatDate(data.start).replaceAll("-", "");
      period.endPeriod = this.formatDate(data.end).replaceAll("-", "");
      period.startPeriod = period.startPeriod.slice(0, 6);
      period.endPeriod = period.endPeriod.slice(0, 6);
      delete period.accountId;
      if(this.accountParams.endAccountCode){
        period.endAccountCode = this.accountParams.endAccountCode;
      }
      if(this.accountParams.startAccountCode){
        period.startAccountCode = this.accountParams.startAccountCode;
      }
      if(uploadType == '0'){//单个
        period.isAll = '0';
        // 批量导出数据
        printExport(
          "/account-book/batch-export-subsidiary-ledger",
          formatType,
          "",
          period
        );
      }else {//批量
        period.isAll = '1';
        // 批量导出数据
        printExport(
          "/account-book/batch-export-subsidiary-ledger",
          formatType,
          "",
          period
        );
      }
      this.batchExportShow = false;


    },
    closeModel() {
      this.batchExportShow = false;
    },
    handleClose() {
      this.accountBookPopupShow = !this.accountBookPopupShow;
    },
  },
  watch: {
    $route(to, from) {
      if(to.name == "detailAccount"){
        // this.formTiem.dateRange = [to.params.period.start,to.params.period.end];
        if (to.query && to.query.subjectId) {
          setTimeout(() => {
            this.clickSubjectIdFlag = "clickSubjcet";
            this.subjectCodeName = to.query.code + " " + to.query.fullName;
            this.$refs.accountBook.setSubjectCode(to.query.code)
            this.accountParams.endAccountCode = to.query.code;
            this.accountParams.startAccountCode = to.query.code;
            this.accountParams.accountId = Number(to.query.subjectId); // 获取对应id
            this.selectIndex = to.query.subjectId; // 动态class
          }, 100);
        }else if(this.$route.params.code){
          // 科目余额表跳转明细表
          this.$refs.accountBook.setSubjectCode(this.$route.params.code)
          this.accountParams.endAccountCode = this.$route.params.code;
          this.accountParams.startAccountCode = this.$route.params.code;
        }
      }
      if (
        to.name === "detailAccount" &&
        (from.name === "voucherInfo" || from.name === "voucherInput")
      ) {
        if (to.query && to.query.subjectId) {
          setTimeout(() => {
            this.clickSubjectIdFlag = "clickSubjcet";
            this.subjectCodeName = to.query.code + " " + to.query.fullName;
            this.$refs.accountBook.setSubjectCode(to.query.code)
            this.accountParams.endAccountCode = to.query.code;
            this.accountParams.startAccountCode = to.query.code;
            this.accountParams.accountId = Number(to.query.subjectId); // 获取对应id
            this.selectIndex = to.query.subjectId; // 动态class
            this.accountParams.start = to.query.date;
            this.accountParams.end = to.query.date;
            this.periodContent =
              to.query.date.slice(0, 7).split("-").join("年") + "期";
            this.currentPeriodObj.startCurren = to.query.date;
            this.currentPeriodObj.endCurren = to.query.date;
            this.detailAccountInit(this.accountParams); // 列表
          }, 100);
        }
      }
      // 监听路由变化，获取表格滚动到的位置
      if(to.fullPath == '/center/detailAccount') {
        let position = sessionStorage.getItem('DetailAccountPagePosition')
        this.$nextTick(() => {
          this.$refs.mainTable.bodyWrapper.scrollTop = position
        })
        this.$nextTick(() => {
          this.$refs.mainTable.bodyWrapper.addEventListener('scroll',() => {
            if(this.$refs.mainTable.bodyWrapper.scrollTop) {
              sessionStorage.setItem('DetailAccountPagePosition', this.$refs.mainTable.bodyWrapper.scrollTop)
            }
          })
        })
      }
      if(from.fullPath == '/center/detailAccount') {
        this.$refs.mainTable.bodyWrapper.addEventListener('scroll', null)
      }
    },
    detailAccountList() {
      // 数据发生改变后，将表格位置重置为缓存保存的位置
      let position = sessionStorage.getItem('DetailAccountPagePosition')
      this.$nextTick(() => {
        this.$refs.mainTable.bodyWrapper.scrollTop = position
      })
    },
    refreshPage(newVal, oldVal) {
      if (newVal === "detailAccount") {
        if (sessionStorage.listStatus) {
          let newStatus = JSON.parse(sessionStorage.listStatus);
          if (
            newStatus.detailAccount === 1 ||
            newStatus.detailAccount === "1"
          ) {
            this.periodListFn("load");
          } else {
            this.periodListFn("tabClick");
          }
        } else {
          this.periodListFn("tabClick");
        }
      }
    },
    accountBookPopupShow: function (val) {
      if (val) {
        document.addEventListener("keydown", (event) => {
          if (event.keyCode === 13 && this.$refs.accountBook) {
            //明细账页面取消监听回车查询功能。解决录入凭证卡顿问题
            //this.$refs.accountBook.seachForm();
          }
        });
      }
    },
    accountParams: function (val) {
      if (val.showZeroNoOccur) {
        this.periodData.showZeroNoOccur = true;
      } else {
        this.periodData.showZeroNoOccur = false;
      }
    },
    subjectInput: {
      handler: function (newVal, oldVal) {
        if (newVal) {
          var arrSub = [];
          this.searchSubjectArray.map((item, key) => {
            if (item.code.indexOf(newVal) >= 0) {
              arrSub.push(item);
            } else if (item.name.indexOf(newVal) >= 0) {
              arrSub.push(item);
            } else if (item.pinyin.indexOf(newVal) >= 0) {
              arrSub.push(item);
            }
          });
          this.subjectArray = arrSub;
        } else {
          this.subjectArray = this.searchSubjectArray;
        }
      },
    },
  },
  components: {
    accountBookPopup,
    batchExportCom,
    dateSelection,
    vPagination
  },
};
</script>

<style lang="less" scoped>
@import "../../../../style/base.less";
.main-top {
  padding-left: 16px;
  .btn-group {
    float: right;
    margin-right: 16px;
    button + button {
      margin-left: 10px;
    }
  }
}
.seach-box{
  width: 400px !important;
  overflow: hidden;
}
.detail-account-box {
  background: transparent;
  .detail_account_head {
    border-radius: 4px;
    margin-bottom: 20px;
    box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.08);
  }
  .main-content {
    display: flex;
    flex-direction: column;
    padding-top: 20px;
    margin: 0;
    .btn-group {
      padding: 0 20px;
      margin-bottom: 20px;
    }
    background: #ffffff;
  }
}

.detail_account_main {
  // display: grid;
  // grid-template-columns: 1fr 19%;
  // grid-template-rows: 1fr;
  // column-gap: 14px;
  display: flex;
  flex-direction:row;
  height: calc(100% - 100px);
}
.main-content .table-main {
  // width: 100%;
  .active {
    color: #5478fb;
    cursor: pointer;
    &:hover {
      text-decoration: none;
    }
  }
}
.main-subject .main-content .table-main{
  width: 80%;
}
.subject-content {
  flex-basis: 300px;
  display: flex;
  flex-direction: column;
  width: 20%;
  min-width: 270px;
  margin: 0;
  border: 1px solid #f0f0f0;
  overflow: scroll;
  .subject-header {
    padding: 15px 10px 0;
    p {
      font-size: 14px;
      color: #333;
    }
    .subject-input {
      margin: 10px 0;
    }
  }
  .subject-item {
    overflow: auto;
    li {
      padding-left: 14px;
      line-height: 30px;
      color: #333;
      cursor: pointer;
      &.active {
        background: #f4f7fa;
      }
    }
  }
}
.table-main .code-active {
  color: #5478fb;
  cursor: pointer;
  &:hover {
    text-decoration: underline;
  }
}
.main-subject .customer-box {
  padding-right: 0 !important;
}
.main-content.customer-box {
  flex-direction: column;
  .table-main {
    height: 100%;
    padding-right: 20px;
    margin-bottom: 0;
    padding-bottom: 20px;
    .redColor {
      color: #ff6666;
    }
    .periodTable {
      // padding-top: 68px;
      // padding-bottom: 35px;
    }
  }
  .page-box {
    margin: 15px 16px 20px 16px;
  }
}
/deep/.el-table td.el-table__cell div {
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
    display: block !important;
}

.float-left{
  float: left;
}
</style>
<style lang="less">
.sumBalance .table-main .el-table__body-wrapper {
  // height: 100%;
  // overflow-y: auto;
}
.sumBalance_search__group {
  display: grid;
  grid-template-columns: 1fr;
  grid-template-rows: auto;
  margin-bottom: 20px;
  padding: 24px 16px 24px 25px;
  background: #fff;
  width: 100%;
  border-radius: 4px;
  box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.08);
  .el-icon-refresh-salf {
    margin-top: 0;
    margin-left: 15px;
  }
}
.sumBalance_content {
  background: #fff;
  border-radius: 4px;
  box-shadow: 0 0 8px 0 rgba(0, 0, 0, 0.08);
  padding-bottom: 0;
  height: calc(100% - 10px);
}
.table-main-cell .el-table .el-table-column--selection .cell{
  padding: 0 !important;
}
.table-main-cell .el-table .is-left .cell{
  justify-content: left !important;
}
.table-main-balance .el-table__body tr.el-table__row--striped td.el-table__cell{
  padding: 5px;
}
.table-main-balance .el-table__body td.el-table__cell{
  padding: 5px;
}
.table-main-balance  tbody td.el-table__cell{
  padding: 5px;
}
.table-main-balance .main-content .table-main .el-table th{
  padding: 5px;
}
.main-subject .main-content .table-main .el-table th{
  padding: 5px !important;
}
.main-subject .el-table__footer-wrapper{
  position: absolute;
  bottom: 0;
  }
.main-subject button.el-button {
  padding: 6px 5px !important;
}
.main-subject .blueHeaderTable.el-table.el-table--striped{
  position: relative;
}
.main-subject .main-top{
  padding: 5px 20px !important;
}

</style>
```



​          this.$refs.accountBook.changeData([new Date(tempData.start), new Date(tempData.end)])



```html
<template>
  <div class="main-subject detail-account-box">
    <div class="detail_account_head"  v-show="isSearchShow">
      <account-book-popup
        ref="accountBook"
        :period-data="periodData"
        :refresh-page="refreshPage"
        :period-data-old="periodDataOld"
        :account-id="accountParams.accountId"
        :code-name-props="codeNameProps"
        :popupType="popupType"
        :subject-options="subjectOptions"
        :disabledDateObj="disabledDateObj"
        @search-list="searchList"
        v-clickoutside="handleClose"
      />
    </div>
    <!-- <div class="main-top"> -->
    <!-- <div class="dateSubject">
        <div class="inputBox" @click.stop="datePeriod">
          {{periodContent}}
          <i></i>
        </div>

        <em class="el-icon-refresh-salf" @click="refreshClick" circle></em>
      </div> -->
    <!-- </div> -->
    <div class="main-content customer-box sumBalance_content">
      <div class="main-top top">
        <el-col :span="14">
          <el-form
            :label-position="labelPosition"
            :inline="true"
            :model="formTiem"
            ref="formTiem"
          >
          <button @click="btn">
            btn
          </button>
             <el-date-picker
              v-model="formTiem.dateRange"
              type="monthrange"
              align="right"
              :picker-options="disabledDateObj"
              start-placeholder="开始日期"
              end-placeholder="结束日期"
              style="width: 180px !important"
              v-show="!isSearchShow"
              @change="limit_search"

            ></el-date-picker>
            <el-button
              v-show="!isSearchShow"
              class="btn-main btn-wide-padding btn__add"
              @click="clickSearch"
              >搜索</el-button
            >
            <el-button class="btn__default" @click="packUp">{{
                this.isSearchShow ? "收起" : "更多查询"
              }}</el-button>

          </el-form>
        </el-col>
        <el-col :span="10">
          <div class="btn-group">
            <el-button
              class="btn btn-main btn-auto"
              @click="currentYearShowClick"
              >{{ currentYearName }}</el-button
            >
            <el-button class="btn__default" @click="printBtn">打印</el-button>
            <!-- <el-button class="btn__default" @click="exportBtn">导出</el-button> -->
            <el-button class="btn__default" @click="batchExportBtn"
              >导出</el-button
            >
          </div>
        </el-col>
      </div>

      <div class="detail_account_main">
        <div class="table-main table-main-balance table-main-cell">
          <el-col :span="1">
            <date-selection
              ref="dateSelection"
              :date="timeInterval"
              @getDate="selectDateGetList"
            />
          </el-col>
          <el-col :span="23">
            <el-table
              border
              height="'100%'"
              class="periodTable"
              ref="mainTable"
              :stripe="true"
              :data="detailAccountList"
              highlight-current-row
              emptyText="暂无数据"
            >
              <el-table-column
                min-width="12%"
                align="left"
                prop="date"
                label="日期"
              >
              </el-table-column>
              <el-table-column min-width="15%" align="left" label="科目">
                <template slot-scope="scope">
                  <div>
                    {{ scope.row.accountCode}} {{ scope.row.accountFullName}}
                  </div>
                </template>
              </el-table-column>
              <el-table-column min-width="8%" align="left" label="凭证字号">
                <template slot-scope="scope">
                  <div class="active" @click="voucherEdit(scope.row.voucherId)">
                    <span v-if="scope.row.voucherNumber ? true : false">记-</span
                    >{{ scope.row.voucherNumber }}
                  </div>
                </template>
              </el-table-column>
              <el-table-column
                min-width="14%"
                align="left"
                prop="digest"
                label="摘要"
              >
              </el-table-column>
              <el-table-column
                min-width="13%"
                align="right"
                style=" float: right !important; "
                prop="debitAmount"
                label="借方"
              >
              </el-table-column>
              <el-table-column
                min-width="13%"
                align="right"
                prop="creditAmount"
                label="贷方"
              >
              </el-table-column>
              <el-table-column min-width="8%" align="left" label="方向">
                <template slot-scope="scope">
                  <span
                    v-html="
                      scope.row.balance === ''
                        ? '平'
                        : scope.row.direction === 0
                        ? '贷'
                        : '借'
                    "
                  ></span>
                </template>
              </el-table-column>
              <el-table-column
                min-width="12%"
                align="right"
                prop="balance"
                label="余额"
              >
              </el-table-column>
            </el-table>
             <div class="page-box" style="margin-bottom: 0!important">
              <v-pagination
                :pageSize="pageObj.pageSize"
                :total="total"
                :currentPage="pageObj.pageNum"
                @change-page-size="changePageSize"
                @change-page="changePage"/>
            </div>
          </el-col>
        </div>

        <div class="subject-content">
          <div class="subject-header">
            <p>
              科目：<span>{{ subjectCodeName }}</span>
            </p>
            <el-input
              class="subject-input"
              v-model.trim="subjectInput"
              placeholder="请输入科目编码、名称或者助记码"
            >
            </el-input>
          </div>
          <ul class="subject-item">
            <li
              v-for="(item, key) in subjectArray"
              :key="key"
              :title="`${item.code} ${item.fullName}` "
              :class="{ active: selectIndex === item.id }"
              @click="clickSubject(item, key)"
            >
              {{ `${item.code} ${item.fullName}` }}
            </li>
          </ul>
        </div>
      </div>
    </div>
    <batch-export-com
      ref="batchExport"
      v-if="batchExportShow"
      :queryParam="accountParams"
      :period-data-old="periodDataOld"
      :periodDate="formTiem.dateRange"
      :disabledDateObj="disabledDateObj"
      @submit-data="submitBatchBtn"
      @close-model="closeModel"
    />
  </div>
</template>

<script>
import { mapGetters } from "vuex";
import { printExport } from "@/api/axios.config";
import accountBook from "@/api/accountBook/accountBook";
import accountBookPopup from "@/components/accountBook/accountBook";
import dateSelection from "@/components/dateSelection/dateSelection";
import batchExportCom from "./exportDetailAccount";
import vPagination from '@/components/Pagination/Pagination'
import { clickoutside, getLastDay } from "@/tools/tools";

export default {
  name: "detailAccount",
  props: {
    refreshPage: {
      type: String,
      default: "",
    },
  },
  data() {
    return {
      detailAccountList: [],
      accountBookPopupShow: false,
      batchExportShow: false,
      selectIndex: 0,
      accountParams: {
        keyWord: "",
        accountId: 0,
        start: "",
        end: "",
        startLevel: 1,
        endLevel: 5,
        showZeroNoOccur: false,
      },
      periodData: {},
      periodDataOld: {}, // 控制期间的选择范围以及对期间进行重置
      periodDataDef: "", // 默认期间的最大值
      periodDataSch: {
        start: "",
        end: "",
      }, // 搜索期间对象
      periodContent: "",
      flag: false,
      subjectInput: "",
      subjectArray: [],
      searchSubjectArray: [],
      subjectCodeName: "",
      currentPeriodObj: {
        startCurren: "",
        endCurren: "",
      },
      codeNameProps: {},
      clickSubjectId: "",
      clickSubjectIdFlag: "",
      detailFlag: "",
      labelPosition: "right",
      formTiem:{
        dateRange: new Date(),
        start: new Date(),
        end: new Date(),
      },
      popupType:'more',
      getPeriodObj: null, // 获取当前期间返回的数据props子组件（筛选）
      disabledDateObj:null,
      isSearchShow: false,
      currentYearShow: true,
      hasYear: 1,
      currentYearName: "隐藏本年累计",
      detailAccountListShow: [],
      detailAccountListHide: [],
      timeInterval:{
        start:null,
        end:null,
      },
      pageObj: {
        pageSize: 200,
        pageNum: 1
      },
      total: 0,
      subjectOptions:[],
      searchAll:{},
      count:0
    };
  },
  directives: { clickoutside },
  computed: {
    ...mapGetters(["formatDate", "formatInt", "getOrder"]),
  },
  created() {
    // this.getPeriod();
    this.periodListFn("load");
    this.querySubjectList();
  },
  mounted() {
    if (
      this.$router.currentRoute.query &&
      this.$router.currentRoute.query.subjectId
    ) {
      setTimeout(() => {
        this.clickSubjectIdFlag = "clickSubjcet";
        this.subjectCodeName =
          this.$router.currentRoute.query.code +
          " " +
          this.$router.currentRoute.query.fullName;
        this.$refs.accountBook.setSubjectCode(this.$router.currentRoute.query.code)
        this.accountParams.endAccountCode = this.$router.currentRoute.query.code;
        this.accountParams.startAccountCode = this.$router.currentRoute.query.code;
        this.accountParams.accountId = Number(
          this.$router.currentRoute.query.subjectId
        ); // 获取对应id
        this.selectIndex = this.$router.currentRoute.query.subjectId; // 动态class
        let date = this.$router.currentRoute.query.date;
        this.accountParams.start = date;
        this.accountParams.end = date;
        this.periodContent = date.slice(0, 7).split("-").join("年") + "期";
        this.currentPeriodObj.startCurren = date;
        this.currentPeriodObj.endCurren = date;
        this.detailAccountInit(this.accountParams); // 列表
        console.log(123456);
      }, 100);
    }
  },
  methods: {
    btn() {
      console.log(111);
      this.$set(this.formTiem,'dateRange', [new Date('2022-02'), new Date('2022-02')])
    },
    querySubjectList(val) {
      // 科目新增检查
      accountBook.SubjectList(val).then(res => {
        if (res.code === 200) {
          this.subjectOptions = res.data.map(item => {
            item.codeName = `${item.code} ${item.name}`;
            return item;
          });
        }
      });
    },
    changePageSize (pageSize) { // 改变数量
      this.pageObj.pageSize = pageSize
      this.pageObj.pageNum = 1
      this.subjectList()

      // 更改分页信息将table 位置变为 0
      sessionStorage.setItem('DetailAccountPagePosition', 0)
      this.$nextTick(() => {
        this.$refs.mainTable.bodyWrapper.scrollTop = 0
      })
    },
    changePage (pageSize, pageNumber) { // 页码
      this.pageObj.pageNum = pageNumber
      this.subjectList()

      // 更改分页信息将table 位置变为 0
      sessionStorage.setItem('DetailAccountPagePosition', 0)
      this.$nextTick(() => {
        this.$refs.mainTable.bodyWrapper.scrollTop = 0
      })
    },
    limit_search(val){
      console.log(val);
      this.$set(this.formTiem.dateRange, new Date());
    },
    selectDateGetList(date) {
      this.accountParams.start = date+'-01';
      this.accountParams.end = date+'-01';
      this.formTiem.dateRange = [date+'-01',date+'-01']
      sessionStorage.setItem('DetailAccountPageSearch', JSON.stringify(
        {
          start:this.accountParams.start = date+'-01',
          end: this.accountParams.end = date+'-01'
        }
      ))
      console.log(22222);
      sessionStorage.setItem('DetailAccountPagePosition', 0)
      this.$refs.accountBook.changeData(this.formTiem.dateRange)
      this.subjectList()
    },
    currentYearShowClick() {
      this.currentYearShow = !this.currentYearShow;
      if (this.detailAccountList.length > 0) {
        this.$nextTick(() => {
          this.$refs.mainTable.bodyWrapper.style.height = "auto";
        });
      }
      if (this.currentYearShow === true) {
        this.currentYearName = "隐藏本年累计";
        this.hasYear = 1;
        this.detailAccountList = [...this.detailAccountListShow]
      } else {
        this.currentYearName = "显示本年累计";
        this.hasYear = 0;
        this.detailAccountList = [...this.detailAccountListHide]
      }
    },
    // 更多查询
    packUp() {
      this.isSearchShow = !this.isSearchShow;
    },
    clickSearch() {
      this.$nextTick(() => {
        this.$refs.mainTable.bodyWrapper.scrollTop = 0
      })

      if (
        this.formTiem.dateRange.length !== undefined &&
        this.formTiem.dateRange.length > 1
      ) {
        this.formTiem.start = this.formatDate(this.formTiem.dateRange[0]);
        this.formTiem.end = this.formatDate(this.formTiem.dateRange[1]);
      } else {
        this.formTiem.start = new Date();
        this.formTiem.end = new Date();
      }

      let startTime = new Date(this.formTiem.start).getTime(); // 获取开始毫秒数
      let endTime = new Date(this.formTiem.end).getTime(); // 获取结束毫秒数
      if (startTime > endTime) {
        this.$message({
          message: "提示：截止期间小于起始期间，请重新输入！",
          type: "error",
        });
      }
      // if (this.formTiem.start && this.formTiem.end) {
      //   this.formTiem.start = this.formatDate(new Date(this.formTiem.start));
      //   this.formTiem.end = this.formatDate(new Date(this.formTiem.end));
      // } else {
      //   this.formTiem.start = this.formatDate(
      //     new Date(this.defaultPeriod.start)
      //   );
      //   this.formTiem.end = this.formatDate(
      //     new Date(this.defaultPeriod.start)
      //   );
      // }
      this.$refs.dateSelection.uncheck();
      this.$refs.accountBook.changeData(this.formTiem.dateRange)
      // sessionStorage.setItem('DetailAccountPageSearch', JSON.stringify(query))
      console.log(this.formTiem, 'fortime');
      // ++++++++++++++
      // this.detailAccountInit(this.formTiem)
      this.searchList(this.formTiem);
      // this.$refs.pqShow.resetForm();
    },
    getPeriod() { 
        // 获取期间接口数据
      accountBook.QueryAccountPeriod().then((res) => {
        if (res.code === 200) {
          let end = this.getDateNow()
          this.getPeriodObj = res.data;
          this.formTiem.dateRange = [this.formatLastDate(res.data.currentPeriod),this.formatLastDate(res.data.currentPeriod)];
          this.disabledDateObj = {
            disabledDate(time) {
              return (
                time.getTime() < new Date(res.data.start).getTime()-86400000 ||
                time.getTime() >= new Date(end).getTime()
              );
            }
          };
          this.timeInterval.end = end;
          this.timeInterval.start = res.data.start;
          this.timeInterval.dateRange = this.formTiem.dateRange;
          this.$refs.accountBook.changeData(this.formTiem.dateRange)
          this.$refs.dateSelection.getDate(this.timeInterval)
        }
      });
    },
    formatLastDate(date) {
      // 格式化日期
      let year = date.slice(0, 4);
      let month = date.slice(5, 7);
      let day = getLastDay(year, month);
      return year + "-" + month + "-" + day;
    },
    getDateNow(){
      var d = new Date();
      var y = d.getFullYear()
      var m = d.getMonth() +1
      var r = d.getDate()
      var data = y + "-" + (m < 10 ? "0" + m : m) + "-" + (r < 10 ? "0" + r : r)
      return data
    },
    routerAccountFn(data) {
      if (this.$route.params.period.start) {
        this.accountParams.start = data.period.start;
        this.accountParams.end = data.period.end;
      } else {
        this.periodContent =
          data.period.start.slice(0, 7).split("-").join("年") + "期";
      }
      this.accountParams.accountId = data.accountId;
      this.selectIndex = data.accountId;
      this.clickSubjectIdFlag = "clickSubjcet";
      this.subjectCodeName = data.codeName;
      this.currentPeriodObj.startCurren = data.period.start;
      this.currentPeriodObj.endCurren = data.period.end;
      this.periodData = this.currentPeriodObj;
      this.periodData.currenFlag = true;
    },
    periodListFn(type) {
      console.log('qijian');
      // 获取期间接口
      accountBook.QueryAccountPeriod().then((res) => {
        if (res.code === 200) {
          this.periodDataOld = res.data;
          if (sessionStorage.listStatus) {
            let newStatus = JSON.parse(sessionStorage.listStatus);
            if (
              newStatus.detailAccount === 1 ||
              newStatus.detailAccount === "1"
            ) {
              newStatus.detailAccount = 0;
              sessionStorage.setItem("listStatus", JSON.stringify(newStatus));
            }
          }
          if (type === "load") {
            if (this.$route.params && this.$route.params.period) {
              // 从科目余额和科目汇总跳转过来的
              this.$refs.accountBook.setSubjectCode(this.$route.params.code)
              this.accountParams.endAccountCode = this.$route.params.code;
              this.accountParams.startAccountCode = this.$route.params.code;
              this.formatPeriod(this.$route.params.period);
              this.accountParams.start = this.$route.params.period.start;
              this.accountParams.end = this.$route.params.period.end;
              this.routerAccountFn(this.$route.params);
            } else {
              this.periodContent =
                res.data.currentPeriod.slice(0, 7).split("-").join("年") + "期";
              this.accountParams.start = res.data.currentPeriod;
              this.accountParams.end = res.data.currentPeriod;
              this.periodDataSch.start = res.data.currentPeriod;
              this.periodDataSch.end = res.data.currentPeriod;
            }
            this.currentPeriodObj.startCurren = res.data.currentPeriod;
            this.currentPeriodObj.endCurren = res.data.currentPeriod;
            this.periodData = this.currentPeriodObj;
            this.periodData.currenFlag = true;
            this.periodData.showZeroNoOccur = this.accountParams.showZeroNoOccur;
            this.periodDataDef = res.data.maxVoucherPeriod;
          } else {
            if (this.$route.params && this.$route.params.period) {
              // 从科目余额和科目汇总跳转过来的
              this.formatPeriod(this.$route.params.period);
              this.accountParams.start = this.$route.params.period.start;
              this.accountParams.end = this.$route.params.period.end;
              this.routerAccountFn(this.$route.params);
            } else {
              if (this.periodDataSch.end) {
                if (this.periodDataSch.end <= res.data.end) {
                  this.accountParams.start = this.periodDataSch.start;
                  this.accountParams.end = this.periodDataSch.end;
                } else {
                  let formatStart = res.data.currentPeriod
                    .slice(0, 7)
                    .split("-")
                    .join("年");
                  this.periodContent = `${formatStart}期`;
                  this.accountParams.end = res.data.currentPeriod;
                }
              } else {
                if (this.periodDataDef > res.data.maxVoucherPeriod) {
                  let formatStart = res.data.currentPeriod
                    .slice(0, 7)
                    .split("-")
                    .join("年");
                  this.periodContent = `${formatStart}期`;
                  this.accountParams.end = res.data.currentPeriod;
                }
              }
            }
            if(this.count === 0) {
              sessionStorage.setItem('DetailAccountPageSearch', JSON.stringify(data))
              this.count++
            }else {
              let getDetailAccountPageSearch = sessionStorage.getItem('DetailAccountPageSearch');
              let tempData = JSON.parse(getDetailAccountPageSearch);
      this.searchList(tempData, this.codeNameProps);
      console.log(tempData, 'tempData');
      this.$nextTick(() => {
        this.$set(this.formTiem,'dateRange', [new Date('2022-02'), new Date('2022-02')])
      })

      this.$set(this.formTiem,"start", tempData.start);
      this.$set(this.formTiem, "end", tempData.end);
              console.log(this.formTiem);
            }
          }
          let end = this.getDateNow()
          this.getPeriodObj = res.data;
          if(this.$router.currentRoute.params.period && this.$router.currentRoute.name == 'detailAccount' && this.$router.currentRoute.params.period.start&& this.$router.currentRoute.params.period.end){
            this.formTiem.dateRange = [this.$router.currentRoute.params.period.start,this.$router.currentRoute.params.period.end];
          }else {
            this.formTiem.dateRange = [this.formatLastDate(res.data.currentPeriod),this.formatLastDate(res.data.currentPeriod)];
          }
          this.$refs.accountBook.changeData(this.formTiem.dateRange)
          this.disabledDateObj = {
            disabledDate(time) {
              return (
                time.getTime() < new Date(res.data.start).getTime()-86400000 ||
                time.getTime() >= new Date(end).getTime()
              );
            }
          };
          this.timeInterval.end = end;
          this.timeInterval.start = res.data.start;
          let startDate  = this.formTiem.dateRange[0].split("-");
          let endDate = this.formTiem.dateRange[1].split("-");
          if((startDate[0] == endDate[0])&&(startDate[1] == endDate[1])){
            this.timeInterval.dateRange = this.formTiem.dateRange;
            this.$refs.dateSelection.getDate(this.timeInterval)
          }else {
            this.timeInterval.dateRange = this.formTiem.dateRange;
            this.$refs.dateSelection.uncheck();
          }
          // this.subjectList();
        }
      });
    },
    subjectList(val) {
      console.log(12);
      // 右侧科目列表
      accountBook.subjectList({...this.accountParams}).then((res) => {
        if (res.code === 200) {
          this.subjectArray = res.data; // 展示数据
          this.searchSubjectArray = res.data; // 模糊查询数据
          this.accountBookPopupShow = false; // 关闭弹框
          if (res.data.length > 0) {
            // 筛选条件不存在右侧选中的科目时，选中右侧科目列表的第一个
            let isSelectSubjectId = this.subjectArray.some((item) => {
              return item.id === this.selectIndex;
            });
            if (!this.clickSubjectIdFlag || !isSelectSubjectId) {
              // this.subjectCodeName = res.data[0].code + ' ' + res.data[0].fullName // 科目：默认选中第一个
              // this.accountParams.accountId = res.data[0].id // 明细账列表默认第一个科目id
              // this.selectIndex = res.data[0].id
              if (this.$router.currentRoute.query.subjectId) {
                this.subjectCodeName =
                  this.$router.currentRoute.query.code +
                  " " +
                  this.$router.currentRoute.query.name;
                this.$refs.accountBook.setSubjectCode(this.$router.currentRoute.query.code)
                this.accountParams.accountId = Number(
                  this.$router.currentRoute.query.subjectId
                ); // 获取对应id
                this.accountParams.start = this.$router.currentRoute.query.date;
                this.accountParams.end = this.$router.currentRoute.query.date;
                this.formTiem.dateRange = [this.accountParams.start,this.accountParams.end];
                this.$refs.accountBook.changeData(this.formTiem.dateRange)
                this.$refs.dateSelection.uncheck();
                this.selectIndex = Number(
                  this.$router.currentRoute.query.subjectId
                );
              } else {
                this.subjectCodeName =
                  res.data[0].code + " " + res.data[0].fullName; // 科目：默认选中第一个
                  if(val != 'seach'){
                    this.$refs.accountBook.setSubjectCode(res.data[0].code)
                  }
                this.accountParams.accountId = res.data[0].id; // 明细账列表默认第一个科目id
                this.selectIndex = res.data[0].id;
              }
              console.log(3);
              // this.detailAccountInit(this.accountParams); // 明细账列表
            } else {
              // this.detailAccountInit(this.accountParams);
            }
          } else {
            this.detailAccountList = [];
            this.subjectCodeName = "";
            // this.$refs.accountBook.setSubjectCode('')
          }
        }
      });
    },
    detailAccountInit(data) {
      console.log(data, 'data');
      let tempData = {}
      console.log(this.count, 'befor count');
      if(this.count === 0) {
        sessionStorage.setItem('DetailAccountPageSearch', JSON.stringify(data))
        console.log(44444);
        this.count++
      }else {
        console.log(sessionStorage.getItem('DetailAccountPageSearch'),'DetailAccountPageSearch');
        let getDetailAccountPageSearch = sessionStorage.getItem('DetailAccountPageSearch');
        tempData = JSON.parse(getDetailAccountPageSearch);
        
      }
      console.log(1234567890987654);
      // this.$nextTick(() => {
          this.$set(this.formTiem, 'dateRange', [new Date(tempData.start), new Date(tempData.end)])
        // })
      console.log(this.count, 'count');
      console.log({...tempData});
      let query = {...tempData}
      delete query.dateRange
      delete query.accountId
      // 明细账列表
      accountBook.dedailAccountListTree({...query,...this.pageObj}).then((res) => {
        if (res.code === 200) {
          this.formatInt(res.data.itemsPage.list);
          let data = [...res.data.itemsPage.list],newData = [];
          this.total = res.data.itemsPage.total;
          data.map((item,index)=>{
            if(item.digest !== '本年累计'){
              newData.push(item)
            }
          })
          this.detailAccountListShow = res.data.items;
          this.detailAccountListHide = newData;
          this.detailAccountList = res.data.itemsPage.list; // 展示数据
          this.accountBookPopupShow = false;
        } else if (res.code === 400) {
          this.$message({
            message: `提示：${res.message}`,
            type: "error",
          });
        }
      });
    },
    voucherEdit(data) {
      sessionStorage.setItem('DetailAccountPagePosition', this.$refs.mainTable.bodyWrapper.scrollTop)

      // 点击凭证字号跳到凭证录入详情
      if (data) {
        this.$store.commit("VOUCHER_INPUT", data);
        sessionStorage.setItem("voucherId", data);
        this.$router.push({
          name: "voucherInfo",
          params: { voucherId: data, isEdit: true },
        });
      }
    },
    refreshClick() {
      // 刷新列表
      if (this.accountParams.accountId !== 0) {
        this.detailAccountInit(this.accountParams);
      }
    },
    clickSubject(item, index) {
      // 点击科目刷新列表
      if(!item){
        item =  this.subjectArray[0]
      }
      this.clickSubjectIdFlag = "clickSubjcet";
      this.accountParams.accountId = item.id; // 获取对应id
      this.subjectCodeName = item.code + " " + item.fullName;
      this.$refs.accountBook.setSubjectCode(item.code)
      this.selectIndex = item.id; // 动态class
      this.accountParams.startAccountCode = item.code;
      this.accountParams.endAccountCode = item.code;
      this.detailAccountInit(this.accountParams); // 列表
      document.querySelector(
        ".detail-account-box .el-table__body-wrapper"
      ).scrollTop = 0; // 搜索设置滚动条距离
    },
    formatPeriod(data) {
      var dateReg = /^(\d{4})-(\d{2})-(\d{2})$/;
      if (dateReg.test(data.start)) {
      } else {
        data.start = this.formatDate(data.start);
        data.end = this.formatDate(data.start);
      }
      // 期间格式化
      let formatStart = data.start.slice(0, 7).split("-").join("年");
      let formatEnd = data.end.slice(0, 7).split("-").join("年");
      if (formatStart === formatEnd) {
        this.periodContent = `${formatStart}期`;
      } else {
        this.periodContent = `${formatStart}期 至 ${formatEnd}期`;
      }
      this.currentPeriodObj.startCurren = data.start;
      this.currentPeriodObj.endCurren = data.end;
    },
    searchList(query, codeNameData) {
      console.log(query, codeNameData);
      sessionStorage.setItem('DetailAccountPageSearch', JSON.stringify(query))
      console.log(33333);

      let data = {...query, ...codeNameData}
      delete data.dateRange;
      // 根据期间相关搜索
      this.formTiem.dateRange = query.dateRange;
      this.$refs.accountBook.changeData(this.formTiem.dateRange)
      this.periodDataSch.start = data.start;
      this.periodDataSch.end = data.end;
      this.accountParams.start = this.formatDate(data.start);
      this.accountParams.end = this.formatDate(data.end);
      this.accountParams = data; // 获取数据
      this.formatPeriod(data); // 格式化期间
      this.subjectList('seach'); // 右侧科目列表
      this.codeNameProps = codeNameData; // 级次数据
      this.accountBookPopupShow = false;
      this.$refs.dateSelection.uncheck();
      // this.detailAccountInit(data)
      document.querySelector(
        ".detail-account-box .el-table__body-wrapper"
      ).scrollTop = 0; // 搜索设置滚动条距离
    },
    datePeriod() {
      // 期间弹框
      this.accountBookPopupShow = !this.accountBookPopupShow;
    },
    printBtn() {
      console.log(this.accountParams);
      let query = {...this.accountParams};
      delete query.startAccountCode;
      delete query.endAccountCode;
      delete query.dateRange;
      // 打印
      printExport(
        "/account-book/export-subsidiary-ledger",
        "print-pdf",
        "",
        query
      );
    },
    exportBtn() {
      let query = {...this.accountParams};
      // delete query.startAccountCode;
      // delete query.endAccountCode;
      // delete query.dateRange;
      // // 导出
      printExport(
        "/account-book/export-subsidiary-ledger",
        "excel",
        "",
        query
      );
    },
    batchExportBtn() {
      // 批量导出弹框
      this.batchExportShow = true;
    },
    submitBatchBtn(data, formatType, uploadType) {
      let period = {...this.accountParams};
      this.formatDate(new Date(this.formTiem.start))
      period.startPeriod = this.formatDate(data.start).replaceAll("-", "");
      period.endPeriod = this.formatDate(data.end).replaceAll("-", "");
      period.startPeriod = period.startPeriod.slice(0, 6);
      period.endPeriod = period.endPeriod.slice(0, 6);
      delete period.accountId;
      if(this.accountParams.endAccountCode){
        period.endAccountCode = this.accountParams.endAccountCode;
      }
      if(this.accountParams.startAccountCode){
        period.startAccountCode = this.accountParams.startAccountCode;
      }
      if(uploadType == '0'){//单个
        period.isAll = '0';
        // 批量导出数据
        printExport(
          "/account-book/batch-export-subsidiary-ledger",
          formatType,
          "",
          period
        );
      }else {//批量
        period.isAll = '1';
        // 批量导出数据
        printExport(
          "/account-book/batch-export-subsidiary-ledger",
          formatType,
          "",
          period
        );
      }
      this.batchExportShow = false;


    },
    closeModel() {
      this.batchExportShow = false;
    },
    handleClose() {
      this.accountBookPopupShow = !this.accountBookPopupShow;
    },
  },
  watch: {
    $route(to, from) {
      if(to.name == "detailAccount"){
        // this.formTiem.dateRange = [to.params.period.start,to.params.period.end];
        if (to.query && to.query.subjectId) {
          setTimeout(() => {
            this.clickSubjectIdFlag = "clickSubjcet";
            this.subjectCodeName = to.query.code + " " + to.query.fullName;
            this.$refs.accountBook.setSubjectCode(to.query.code)
            this.accountParams.endAccountCode = to.query.code;
            this.accountParams.startAccountCode = to.query.code;
            this.accountParams.accountId = Number(to.query.subjectId); // 获取对应id
            this.selectIndex = to.query.subjectId; // 动态class
          }, 100);
        }else if(this.$route.params.code){
          // 科目余额表跳转明细表
          this.$refs.accountBook.setSubjectCode(this.$route.params.code)
          this.accountParams.endAccountCode = this.$route.params.code;
          this.accountParams.startAccountCode = this.$route.params.code;
        }
      }
      if (
        to.name === "detailAccount" &&
        (from.name === "voucherInfo" || from.name === "voucherInput")
      ) {
        if (to.query && to.query.subjectId) {
          setTimeout(() => {
            this.clickSubjectIdFlag = "clickSubjcet";
            this.subjectCodeName = to.query.code + " " + to.query.fullName;
            this.$refs.accountBook.setSubjectCode(to.query.code)
            this.accountParams.endAccountCode = to.query.code;
            this.accountParams.startAccountCode = to.query.code;
            this.accountParams.accountId = Number(to.query.subjectId); // 获取对应id
            this.selectIndex = to.query.subjectId; // 动态class
            this.accountParams.start = to.query.date;
            this.accountParams.end = to.query.date;
            this.periodContent =
              to.query.date.slice(0, 7).split("-").join("年") + "期";
            this.currentPeriodObj.startCurren = to.query.date;
            this.currentPeriodObj.endCurren = to.query.date;
            // this.detailAccountInit(this.accountParams); // 列表
          }, 100);
        }
      }
      // 监听路由变化，获取表格滚动到的位置
      if(to.fullPath == '/center/detailAccount') {
        let position = sessionStorage.getItem('DetailAccountPagePosition')
        this.$nextTick(() => {
          this.$refs.mainTable.bodyWrapper.scrollTop = position
        })
        this.$nextTick(() => {
          this.$refs.mainTable.bodyWrapper.addEventListener('scroll',() => {
            if(this.$refs.mainTable.bodyWrapper.scrollTop) {
              sessionStorage.setItem('DetailAccountPagePosition', this.$refs.mainTable.bodyWrapper.scrollTop)
            }
          })
        })
      }
      if(from.fullPath == '/center/detailAccount') {
        this.$refs.mainTable.bodyWrapper.addEventListener('scroll', null)
      }
    },
    detailAccountList() {
      // 数据发生改变后，将表格位置重置为缓存保存的位置
      let position = sessionStorage.getItem('DetailAccountPagePosition')
      this.$nextTick(() => {
        this.$refs.mainTable.bodyWrapper.scrollTop = position
      })
    },
    refreshPage(newVal, oldVal) {
      if (newVal === "detailAccount") {
        if (sessionStorage.listStatus) {
          let newStatus = JSON.parse(sessionStorage.listStatus);
          if (
            newStatus.detailAccount === 1 ||
            newStatus.detailAccount === "1"
          ) {
            this.periodListFn("load");
          } else {
            this.periodListFn("tabClick");
          }
        } else {
          this.periodListFn("tabClick");
        }
      }
    },
    accountBookPopupShow: function (val) {
      if (val) {
        document.addEventListener("keydown", (event) => {
          if (event.keyCode === 13 && this.$refs.accountBook) {
            //明细账页面取消监听回车查询功能。解决录入凭证卡顿问题
            //this.$refs.accountBook.seachForm();
          }
        });
      }
    },
    accountParams: function (val) {
      if (val.showZeroNoOccur) {
        this.periodData.showZeroNoOccur = true;
      } else {
        this.periodData.showZeroNoOccur = false;
      }
    },
    subjectInput: {
      handler: function (newVal, oldVal) {
        if (newVal) {
          var arrSub = [];
          this.searchSubjectArray.map((item, key) => {
            if (item.code.indexOf(newVal) >= 0) {
              arrSub.push(item);
            } else if (item.name.indexOf(newVal) >= 0) {
              arrSub.push(item);
            } else if (item.pinyin.indexOf(newVal) >= 0) {
              arrSub.push(item);
            }
          });
          this.subjectArray = arrSub;
        } else {
          this.subjectArray = this.searchSubjectArray;
        }
      },
    },
  },
  components: {
    accountBookPopup,
    batchExportCom,
    dateSelection,
    vPagination
  },
};
</script>

<style lang="less" scoped>
@import "../../../../style/base.less";
.main-top {
  padding-left: 16px;
  .btn-group {
    float: right;
    margin-right: 16px;
    button + button {
      margin-left: 10px;
    }
  }
}
.seach-box{
  width: 400px !important;
  overflow: hidden;
}
.detail-account-box {
  background: transparent;
  .detail_account_head {
    border-radius: 4px;
    margin-bottom: 20px;
    box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.08);
  }
  .main-content {
    display: flex;
    flex-direction: column;
    padding-top: 20px;
    margin: 0;
    .btn-group {
      padding: 0 20px;
      margin-bottom: 20px;
    }
    background: #ffffff;
  }
}

.detail_account_main {
  // display: grid;
  // grid-template-columns: 1fr 19%;
  // grid-template-rows: 1fr;
  // column-gap: 14px;
  display: flex;
  flex-direction:row;
  height: calc(100% - 100px);
}
.main-content .table-main {
  // width: 100%;
  .active {
    color: #5478fb;
    cursor: pointer;
    &:hover {
      text-decoration: none;
    }
  }
}
.main-subject .main-content .table-main{
  width: 80%;
}
.subject-content {
  flex-basis: 300px;
  display: flex;
  flex-direction: column;
  width: 20%;
  min-width: 270px;
  margin: 0;
  border: 1px solid #f0f0f0;
  overflow: scroll;
  .subject-header {
    padding: 15px 10px 0;
    p {
      font-size: 14px;
      color: #333;
    }
    .subject-input {
      margin: 10px 0;
    }
  }
  .subject-item {
    overflow: auto;
    li {
      padding-left: 14px;
      line-height: 30px;
      color: #333;
      cursor: pointer;
      &.active {
        background: #f4f7fa;
      }
    }
  }
}
.table-main .code-active {
  color: #5478fb;
  cursor: pointer;
  &:hover {
    text-decoration: underline;
  }
}
.main-subject .customer-box {
  padding-right: 0 !important;
}
.main-content.customer-box {
  flex-direction: column;
  .table-main {
    height: 100%;
    padding-right: 20px;
    margin-bottom: 0;
    padding-bottom: 20px;
    .redColor {
      color: #ff6666;
    }
    .periodTable {
      // padding-top: 68px;
      // padding-bottom: 35px;
    }
  }
  .page-box {
    margin: 15px 16px 20px 16px;
  }
}
/deep/.el-table td.el-table__cell div {
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
    display: block !important;
}

.float-left{
  float: left;
}
</style>
<style lang="less">
.sumBalance .table-main .el-table__body-wrapper {
  // height: 100%;
  // overflow-y: auto;
}
.sumBalance_search__group {
  display: grid;
  grid-template-columns: 1fr;
  grid-template-rows: auto;
  margin-bottom: 20px;
  padding: 24px 16px 24px 25px;
  background: #fff;
  width: 100%;
  border-radius: 4px;
  box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.08);
  .el-icon-refresh-salf {
    margin-top: 0;
    margin-left: 15px;
  }
}
.sumBalance_content {
  background: #fff;
  border-radius: 4px;
  box-shadow: 0 0 8px 0 rgba(0, 0, 0, 0.08);
  padding-bottom: 0;
  height: calc(100% - 10px);
}
.table-main-cell .el-table .el-table-column--selection .cell{
  padding: 0 !important;
}
.table-main-cell .el-table .is-left .cell{
  justify-content: left !important;
}
.table-main-balance .el-table__body tr.el-table__row--striped td.el-table__cell{
  padding: 5px;
}
.table-main-balance .el-table__body td.el-table__cell{
  padding: 5px;
}
.table-main-balance  tbody td.el-table__cell{
  padding: 5px;
}
.table-main-balance .main-content .table-main .el-table th{
  padding: 5px;
}
.main-subject .main-content .table-main .el-table th{
  padding: 5px !important;
}
.main-subject .el-table__footer-wrapper{
  position: absolute;
  bottom: 0;
  }
.main-subject button.el-button {
  padding: 6px 5px !important;
}
.main-subject .blueHeaderTable.el-table.el-table--striped{
  position: relative;
}
.main-subject .main-top{
  padding: 5px 20px !important;
}

</style>
```

最终版

```html
<template>
  <div class="main-subject detail-account-box">
    <div class="detail_account_head"  v-show="isSearchShow">
      <account-book-popup
        ref="accountBook"
        :period-data="periodData"
        :refresh-page="refreshPage"
        :period-data-old="periodDataOld"
        :account-id="accountParams.accountId"
        :code-name-props="codeNameProps"
        :popupType="popupType"
        :subject-options="subjectOptions"
        :disabledDateObj="disabledDateObj"
        @search-list="searchList"
        v-clickoutside="handleClose"
      />
    </div>
    <!-- <div class="main-top"> -->
    <!-- <div class="dateSubject">
        <div class="inputBox" @click.stop="datePeriod">
          {{periodContent}}
          <i></i>
        </div>

        <em class="el-icon-refresh-salf" @click="refreshClick" circle></em>
      </div> -->
    <!-- </div> -->
    <div class="main-content customer-box sumBalance_content">
      <div class="main-top top">
        <el-col :span="14">
          <el-form
            :label-position="labelPosition"
            :inline="true"
            :model="formTiem"
            ref="formTiem"
          >
             <el-date-picker
              v-model="formTiem.dateRange"
              type="monthrange"
              align="right"
              :picker-options="disabledDateObj"
              start-placeholder="开始日期"
              end-placeholder="结束日期"
              style="width: 180px !important"
              v-show="!isSearchShow"
              @change="limit_search"

            ></el-date-picker>
            <el-button
              v-show="!isSearchShow"
              class="btn-main btn-wide-padding btn__add"
              @click="clickSearch"
              >搜索</el-button
            >
            <el-button class="btn__default" @click="packUp">{{
                this.isSearchShow ? "收起" : "更多查询"
              }}</el-button>

          </el-form>
        </el-col>
        <el-col :span="10">
          <div class="btn-group">
            <el-button
              class="btn btn-main btn-auto"
              @click="currentYearShowClick"
              >{{ currentYearName }}</el-button
            >
            <el-button class="btn__default" @click="printBtn">打印</el-button>
            <!-- <el-button class="btn__default" @click="exportBtn">导出</el-button> -->
            <el-button class="btn__default" @click="batchExportBtn"
              >导出</el-button
            >
          </div>
        </el-col>
      </div>

      <div class="detail_account_main">
        <div class="table-main table-main-balance table-main-cell">
          <el-col :span="1">
            <date-selection
              ref="dateSelection"
              :date="timeInterval"
              @getDate="selectDateGetList"
            />
          </el-col>
          <el-col :span="23">
            <el-table
              border
              height="'100%'"
              class="periodTable"
              ref="mainTable"
              :stripe="true"
              :data="detailAccountList"
              highlight-current-row
              emptyText="暂无数据"
            >
              <el-table-column
                min-width="12%"
                align="left"
                prop="date"
                label="日期"
              >
              </el-table-column>
              <el-table-column min-width="15%" align="left" label="科目">
                <template slot-scope="scope">
                  <div>
                    {{ scope.row.accountCode}} {{ scope.row.accountFullName}}
                  </div>
                </template>
              </el-table-column>
              <el-table-column min-width="8%" align="left" label="凭证字号">
                <template slot-scope="scope">
                  <div class="active" @click="voucherEdit(scope.row.voucherId)">
                    <span v-if="scope.row.voucherNumber ? true : false">记-</span
                    >{{ scope.row.voucherNumber }}
                  </div>
                </template>
              </el-table-column>
              <el-table-column
                min-width="14%"
                align="left"
                prop="digest"
                label="摘要"
              >
              </el-table-column>
              <el-table-column
                min-width="13%"
                align="right"
                style=" float: right !important; "
                prop="debitAmount"
                label="借方"
              >
              </el-table-column>
              <el-table-column
                min-width="13%"
                align="right"
                prop="creditAmount"
                label="贷方"
              >
              </el-table-column>
              <el-table-column min-width="8%" align="left" label="方向">
                <template slot-scope="scope">
                  <span
                    v-html="
                      scope.row.balance === ''
                        ? '平'
                        : scope.row.direction === 0
                        ? '贷'
                        : '借'
                    "
                  ></span>
                </template>
              </el-table-column>
              <el-table-column
                min-width="12%"
                align="right"
                prop="balance"
                label="余额"
              >
              </el-table-column>
            </el-table>
             <div class="page-box" style="margin-bottom: 0!important">
              <v-pagination
                :pageSize="pageObj.pageSize"
                :total="total"
                :currentPage="pageObj.pageNum"
                @change-page-size="changePageSize"
                @change-page="changePage"/>
            </div>
          </el-col>
        </div>

        <div class="subject-content">
          <div class="subject-header">
            <p>
              科目：<span>{{ subjectCodeName }}</span>
            </p>
            <el-input
              class="subject-input"
              v-model.trim="subjectInput"
              placeholder="请输入科目编码、名称或者助记码"
            >
            </el-input>
          </div>
          <ul class="subject-item">
            <li
              v-for="(item, key) in subjectArray"
              :key="key"
              :title="`${item.code} ${item.fullName}` "
              :class="{ active: selectIndex === item.id }"
              @click="clickSubject(item, key)"
            >
              {{ `${item.code} ${item.fullName}` }}
            </li>
          </ul>
        </div>
      </div>
    </div>
    <batch-export-com
      ref="batchExport"
      v-if="batchExportShow"
      :queryParam="accountParams"
      :period-data-old="periodDataOld"
      :periodDate="formTiem.dateRange"
      :disabledDateObj="disabledDateObj"
      @submit-data="submitBatchBtn"
      @close-model="closeModel"
    />
  </div>
</template>

<script>
import { mapGetters } from "vuex";
import { printExport } from "@/api/axios.config";
import accountBook from "@/api/accountBook/accountBook";
import accountBookPopup from "@/components/accountBook/accountBook";
import dateSelection from "@/components/dateSelection/dateSelection";
import batchExportCom from "./exportDetailAccount";
import vPagination from '@/components/Pagination/Pagination'
import { clickoutside, getLastDay } from "@/tools/tools";

export default {
  name: "detailAccount",
  props: {
    refreshPage: {
      type: String,
      default: "",
    },
  },
  data() {
    return {
      detailAccountList: [],
      accountBookPopupShow: false,
      batchExportShow: false,
      selectIndex: 0,
      accountParams: {
        keyWord: "",
        accountId: 0,
        start: "",
        end: "",
        startLevel: 1,
        endLevel: 5,
        showZeroNoOccur: false,
      },
      periodData: {},
      periodDataOld: {}, // 控制期间的选择范围以及对期间进行重置
      periodDataDef: "", // 默认期间的最大值
      periodDataSch: {
        start: "",
        end: "",
      }, // 搜索期间对象
      periodContent: "",
      flag: false,
      subjectInput: "",
      subjectArray: [],
      searchSubjectArray: [],
      subjectCodeName: "",
      currentPeriodObj: {
        startCurren: "",
        endCurren: "",
      },
      codeNameProps: {},
      clickSubjectId: "",
      clickSubjectIdFlag: "",
      detailFlag: "",
      labelPosition: "right",
      formTiem:{
        dateRange: new Date(),
        start: new Date(),
        end: new Date(),
      },
      popupType:'more',
      getPeriodObj: null, // 获取当前期间返回的数据props子组件（筛选）
      disabledDateObj:null,
      isSearchShow: false,
      currentYearShow: true,
      hasYear: 1,
      currentYearName: "隐藏本年累计",
      detailAccountListShow: [],
      detailAccountListHide: [],
      timeInterval:{
        start:null,
        end:null,
      },
      pageObj: {
        pageSize: 200,
        pageNum: 1
      },
      total: 0,
      subjectOptions:[],
      searchAll:{},
      count:0
    };
  },
  directives: { clickoutside },
  computed: {
    ...mapGetters(["formatDate", "formatInt", "getOrder"]),
  },
  created() {
    // this.getPeriod();
    this.periodListFn("load");
    this.querySubjectList();
  },
  mounted() {
    this.$nextTick(() => {
      this.$refs.mainTable.bodyWrapper.addEventListener('scroll',() => {
        if(this.$refs.mainTable.bodyWrapper.scrollTop) {
          sessionStorage.setItem('DetailAccountPagePosition', this.$refs.mainTable.bodyWrapper.scrollTop)
        }
      })
    })
    if (
      this.$router.currentRoute.query &&
      this.$router.currentRoute.query.subjectId
    ) {
      setTimeout(() => {
        this.clickSubjectIdFlag = "clickSubjcet";
        this.subjectCodeName =
          this.$router.currentRoute.query.code +
          " " +
          this.$router.currentRoute.query.fullName;
        this.$refs.accountBook.setSubjectCode(this.$router.currentRoute.query.code)
        this.accountParams.endAccountCode = this.$router.currentRoute.query.code;
        this.accountParams.startAccountCode = this.$router.currentRoute.query.code;
        this.accountParams.accountId = Number(
          this.$router.currentRoute.query.subjectId
        ); // 获取对应id
        this.selectIndex = this.$router.currentRoute.query.subjectId; // 动态class
        let date = this.$router.currentRoute.query.date;
        this.accountParams.start = date;
        this.accountParams.end = date;
        this.periodContent = date.slice(0, 7).split("-").join("年") + "期";
        this.currentPeriodObj.startCurren = date;
        this.currentPeriodObj.endCurren = date;
        this.detailAccountInit(this.accountParams); // 列表
      }, 100);
    }
  },
  methods: {
    querySubjectList(val) {
      // 科目新增检查
      accountBook.SubjectList(val).then(res => {
        if (res.code === 200) {
          this.subjectOptions = res.data.map(item => {
            item.codeName = `${item.code} ${item.name}`;
            return item;
          });
        }
      });
    },
    changePageSize (pageSize) { // 改变数量
      this.pageObj.pageSize = pageSize
      this.pageObj.pageNum = 1
      this.subjectList()

      // 更改分页信息将table 位置变为 0
      sessionStorage.setItem('DetailAccountPagePosition', 0)
      this.$nextTick(() => {
        this.$refs.mainTable.bodyWrapper.scrollTop = 0
      })
    },
    changePage (pageSize, pageNumber) { // 页码
      this.pageObj.pageNum = pageNumber
      this.subjectList()

      // 更改分页信息将table 位置变为 0
      sessionStorage.setItem('DetailAccountPagePosition', 0)
      this.$nextTick(() => {
        this.$refs.mainTable.bodyWrapper.scrollTop = 0
      })
    },
    limit_search(val){
      this.$set(this.formTiem.dateRange, new Date());
    },
    selectDateGetList(date) {
      this.accountParams.start = date+'-01';
      this.accountParams.end = date+'-01';
      this.formTiem.dateRange = [date+'-01',date+'-01']
      sessionStorage.setItem('DetailAccountPageSearch', JSON.stringify(
        {
          start:this.accountParams.start = date+'-01',
          end: this.accountParams.end = date+'-01'
        }
      ))
      sessionStorage.setItem('DetailAccountPagePosition', 0)
      this.$refs.accountBook.changeData(this.formTiem.dateRange)
      this.subjectList()
    },
    currentYearShowClick() {
      this.currentYearShow = !this.currentYearShow;
      if (this.detailAccountList.length > 0) {
        this.$nextTick(() => {
          this.$refs.mainTable.bodyWrapper.style.height = "auto";
        });
      }
      if (this.currentYearShow === true) {
        this.currentYearName = "隐藏本年累计";
        this.hasYear = 1;
        this.detailAccountList = [...this.detailAccountListShow]
      } else {
        this.currentYearName = "显示本年累计";
        this.hasYear = 0;
        this.detailAccountList = [...this.detailAccountListHide]
      }
    },
    // 更多查询
    packUp() {
      this.isSearchShow = !this.isSearchShow;
    },
    clickSearch() {
      this.$nextTick(() => {
        this.$refs.mainTable.bodyWrapper.scrollTop = 0
      })
      sessionStorage.setItem('DetailAccountPagePosition', 0)

      if (
        this.formTiem.dateRange.length !== undefined &&
        this.formTiem.dateRange.length > 1
      ) {
        this.formTiem.start = this.formatDate(this.formTiem.dateRange[0]);
        this.formTiem.end = this.formatDate(this.formTiem.dateRange[1]);
      } else {
        this.formTiem.start = new Date();
        this.formTiem.end = new Date();
      }

      let startTime = new Date(this.formTiem.start).getTime(); // 获取开始毫秒数
      let endTime = new Date(this.formTiem.end).getTime(); // 获取结束毫秒数
      if (startTime > endTime) {
        this.$message({
          message: "提示：截止期间小于起始期间，请重新输入！",
          type: "error",
        });
      }
      // if (this.formTiem.start && this.formTiem.end) {
      //   this.formTiem.start = this.formatDate(new Date(this.formTiem.start));
      //   this.formTiem.end = this.formatDate(new Date(this.formTiem.end));
      // } else {
      //   this.formTiem.start = this.formatDate(
      //     new Date(this.defaultPeriod.start)
      //   );
      //   this.formTiem.end = this.formatDate(
      //     new Date(this.defaultPeriod.start)
      //   );
      // }
      this.$refs.dateSelection.uncheck();
      this.$refs.accountBook.changeData(this.formTiem.dateRange)
      console.log(this.formTiem);
      // ++++++++++++++
      // this.detailAccountInit(this.formTiem)
      this.searchList(this.formTiem);
      // this.$refs.pqShow.resetForm();
    },
    getPeriod() { 
        // 获取期间接口数据
      accountBook.QueryAccountPeriod().then((res) => {
        if (res.code === 200) {
          let end = this.getDateNow()
          this.getPeriodObj = res.data;
          this.formTiem.dateRange = [this.formatLastDate(res.data.currentPeriod),this.formatLastDate(res.data.currentPeriod)];
          this.disabledDateObj = {
            disabledDate(time) {
              return (
                time.getTime() < new Date(res.data.start).getTime()-86400000 ||
                time.getTime() >= new Date(end).getTime()
              );
            }
          };
          this.timeInterval.end = end;
          this.timeInterval.start = res.data.start;
          this.timeInterval.dateRange = this.formTiem.dateRange;
          this.$refs.accountBook.changeData(this.formTiem.dateRange)
          this.$refs.dateSelection.getDate(this.timeInterval)
        }
      });
    },
    formatLastDate(date) {
      // 格式化日期
      let year = date.slice(0, 4);
      let month = date.slice(5, 7);
      let day = getLastDay(year, month);
      return year + "-" + month + "-" + day;
    },
    getDateNow(){
      var d = new Date();
      var y = d.getFullYear()
      var m = d.getMonth() +1
      var r = d.getDate()
      var data = y + "-" + (m < 10 ? "0" + m : m) + "-" + (r < 10 ? "0" + r : r)
      return data
    },
    routerAccountFn(data) {
      if (this.$route.params.period.start) {
        this.accountParams.start = data.period.start;
        this.accountParams.end = data.period.end;
      } else {
        this.periodContent =
          data.period.start.slice(0, 7).split("-").join("年") + "期";
      }
      this.accountParams.accountId = data.accountId;
      this.selectIndex = data.accountId;
      this.clickSubjectIdFlag = "clickSubjcet";
      this.subjectCodeName = data.codeName;
      this.currentPeriodObj.startCurren = data.period.start;
      this.currentPeriodObj.endCurren = data.period.end;
      this.periodData = this.currentPeriodObj;
      this.periodData.currenFlag = true;
    },
    periodListFn(type) {
      // 获取期间接口
      accountBook.QueryAccountPeriod().then((res) => {
        if (res.code === 200) {
          this.periodDataOld = res.data;
          if (sessionStorage.listStatus) {
            let newStatus = JSON.parse(sessionStorage.listStatus);
            if (
              newStatus.detailAccount === 1 ||
              newStatus.detailAccount === "1"
            ) {
              newStatus.detailAccount = 0;
              sessionStorage.setItem("listStatus", JSON.stringify(newStatus));
            }
          }
          if (type === "load") {
            if (this.$route.params && this.$route.params.period) {
              // 从科目余额和科目汇总跳转过来的
              this.$refs.accountBook.setSubjectCode(this.$route.params.code)
              this.accountParams.endAccountCode = this.$route.params.code;
              this.accountParams.startAccountCode = this.$route.params.code;
              this.formatPeriod(this.$route.params.period);
              this.accountParams.start = this.$route.params.period.start;
              this.accountParams.end = this.$route.params.period.end;
              this.routerAccountFn(this.$route.params);
            } else {
              this.periodContent =
                res.data.currentPeriod.slice(0, 7).split("-").join("年") + "期";
              this.accountParams.start = res.data.currentPeriod;
              this.accountParams.end = res.data.currentPeriod;
              this.periodDataSch.start = res.data.currentPeriod;
              this.periodDataSch.end = res.data.currentPeriod;
            }
            this.currentPeriodObj.startCurren = res.data.currentPeriod;
            this.currentPeriodObj.endCurren = res.data.currentPeriod;
            this.periodData = this.currentPeriodObj;
            this.periodData.currenFlag = true;
            this.periodData.showZeroNoOccur = this.accountParams.showZeroNoOccur;
            this.periodDataDef = res.data.maxVoucherPeriod;
          } else {
            if (this.$route.params && this.$route.params.period) {
              // 从科目余额和科目汇总跳转过来的
              this.formatPeriod(this.$route.params.period);
              this.accountParams.start = this.$route.params.period.start;
              this.accountParams.end = this.$route.params.period.end;
              this.routerAccountFn(this.$route.params);
            } else {
              if (this.periodDataSch.end) {
                if (this.periodDataSch.end <= res.data.end) {
                  this.accountParams.start = this.periodDataSch.start;
                  this.accountParams.end = this.periodDataSch.end;
                } else {
                  let formatStart = res.data.currentPeriod
                    .slice(0, 7)
                    .split("-")
                    .join("年");
                  this.periodContent = `${formatStart}期`;
                  this.accountParams.end = res.data.currentPeriod;
                }
              } else {
                if (this.periodDataDef > res.data.maxVoucherPeriod) {
                  let formatStart = res.data.currentPeriod
                    .slice(0, 7)
                    .split("-")
                    .join("年");
                  this.periodContent = `${formatStart}期`;
                  this.accountParams.end = res.data.currentPeriod;
                }
              }
            }
            if(this.count === 0) {
              sessionStorage.setItem('DetailAccountPageSearch', JSON.stringify(data))
              this.$set(this.formTiem,"start", data.start);
              this.$set(this.formTiem, "end", data.end);
              this.count++
            }else {
              let getDetailAccountPageSearch = sessionStorage.getItem('DetailAccountPageSearch');
              let tempData = JSON.parse(getDetailAccountPageSearch);
              this.searchList(tempData, this.codeNameProps);
              this.$set(this.formTiem,"start", tempData.start);
              this.$set(this.formTiem, "end", tempData.end);
            }
          }
          let end = this.getDateNow()
          this.getPeriodObj = res.data;
          if(this.$router.currentRoute.params.period && this.$router.currentRoute.name == 'detailAccount' && this.$router.currentRoute.params.period.start&& this.$router.currentRoute.params.period.end){
            this.formTiem.dateRange = [this.$router.currentRoute.params.period.start,this.$router.currentRoute.params.period.end];
          }else {
            this.formTiem.dateRange = [this.formatLastDate(res.data.currentPeriod),this.formatLastDate(res.data.currentPeriod)];
          }
          this.$refs.accountBook.changeData(this.formTiem.dateRange)
          this.disabledDateObj = {
            disabledDate(time) {
              return (
                time.getTime() < new Date(res.data.start).getTime()-86400000 ||
                time.getTime() >= new Date(end).getTime()
              );
            }
          };
          this.timeInterval.end = end;
          this.timeInterval.start = res.data.start;
          let startDate  = this.formTiem.dateRange[0].split("-");
          let endDate = this.formTiem.dateRange[1].split("-");
          if((startDate[0] == endDate[0])&&(startDate[1] == endDate[1])){
            this.timeInterval.dateRange = this.formTiem.dateRange;
            this.$refs.dateSelection.getDate(this.timeInterval)
          }else {
            this.timeInterval.dateRange = this.formTiem.dateRange;
            this.$refs.dateSelection.uncheck();
          }
          this.subjectList();
        }
      });
    },
    subjectList(val) {
      // 右侧科目列表
      accountBook.subjectList({...this.accountParams}).then((res) => {
        if (res.code === 200) {
          this.subjectArray = res.data; // 展示数据
          this.searchSubjectArray = res.data; // 模糊查询数据
          this.accountBookPopupShow = false; // 关闭弹框
          if (res.data.length > 0) {
            // 筛选条件不存在右侧选中的科目时，选中右侧科目列表的第一个
            let isSelectSubjectId = this.subjectArray.some((item) => {
              return item.id === this.selectIndex;
            });
            if (!this.clickSubjectIdFlag || !isSelectSubjectId) {
              // this.subjectCodeName = res.data[0].code + ' ' + res.data[0].fullName // 科目：默认选中第一个
              // this.accountParams.accountId = res.data[0].id // 明细账列表默认第一个科目id
              // this.selectIndex = res.data[0].id
              if (this.$router.currentRoute.query.subjectId) {
                this.subjectCodeName =
                  this.$router.currentRoute.query.code +
                  " " +
                  this.$router.currentRoute.query.name;
                this.$refs.accountBook.setSubjectCode(this.$router.currentRoute.query.code)
                this.accountParams.accountId = Number(
                  this.$router.currentRoute.query.subjectId
                ); // 获取对应id
                this.accountParams.start = this.$router.currentRoute.query.date;
                this.accountParams.end = this.$router.currentRoute.query.date;
                this.formTiem.dateRange = [this.accountParams.start,this.accountParams.end];
                this.$refs.accountBook.changeData(this.formTiem.dateRange)
                this.$refs.dateSelection.uncheck();
                this.selectIndex = Number(
                  this.$router.currentRoute.query.subjectId
                );
              } else {
                this.subjectCodeName =
                  res.data[0].code + " " + res.data[0].fullName; // 科目：默认选中第一个
                  if(val != 'seach'){
                    this.$refs.accountBook.setSubjectCode(res.data[0].code)
                  }
                this.accountParams.accountId = res.data[0].id; // 明细账列表默认第一个科目id
                this.selectIndex = res.data[0].id;
              }
              this.detailAccountInit(this.accountParams); // 明细账列表
            } else {
              this.detailAccountInit(this.accountParams);
            }
          } else {
            this.detailAccountList = [];
            this.subjectCodeName = "";
            // this.$refs.accountBook.setSubjectCode('')
          }
        }
      });
    },
    detailAccountInit(data) {
      let tempData = {}
      if(this.count === 0) {
        sessionStorage.setItem('DetailAccountPageSearch', JSON.stringify(data))
        tempData = data;
        this.count++
      }else {
        let getDetailAccountPageSearch = sessionStorage.getItem('DetailAccountPageSearch');
        tempData = JSON.parse(getDetailAccountPageSearch);
      }
      this.$set(this.formTiem, 'dateRange', [new Date(tempData.start), new Date(tempData.end)])
      // this.$refs.accountBook.changeData2(tempData.start,tempData.end)
      this.$refs.dateSelection.uncheck();
      let query = {...tempData}
      delete query.dateRange
      delete query.accountId
      // 明细账列表
      accountBook.dedailAccountListTree({...query,...this.pageObj}).then((res) => {
        if (res.code === 200) {
          this.formatInt(res.data.itemsPage.list);
          let data = [...res.data.itemsPage.list],newData = [];
          this.total = res.data.itemsPage.total;
          data.map((item,index)=>{
            if(item.digest !== '本年累计'){
              newData.push(item)
            }
          })
          this.detailAccountListShow = res.data.items;
          this.detailAccountListHide = newData;
          this.detailAccountList = res.data.itemsPage.list; // 展示数据
          this.accountBookPopupShow = false;
        } else if (res.code === 400) {
          this.$message({
            message: `提示：${res.message}`,
            type: "error",
          });
        }
      });
    },
    voucherEdit(data) {
      sessionStorage.setItem('DetailAccountPagePosition', this.$refs.mainTable.bodyWrapper.scrollTop)

      // 点击凭证字号跳到凭证录入详情
      if (data) {
        this.$store.commit("VOUCHER_INPUT", data);
        sessionStorage.setItem("voucherId", data);
        this.$router.push({
          name: "voucherInfo",
          params: { voucherId: data, isEdit: true },
        });
      }
    },
    refreshClick() {
      // 刷新列表
      if (this.accountParams.accountId !== 0) {
        this.detailAccountInit(this.accountParams);
      }
    },
    clickSubject(item, index) {
      // 点击科目刷新列表
      if(!item){
        item =  this.subjectArray[0]
      }
      this.clickSubjectIdFlag = "clickSubjcet";
      this.accountParams.accountId = item.id; // 获取对应id
      this.subjectCodeName = item.code + " " + item.fullName;
      this.$refs.accountBook.setSubjectCode(item.code)
      this.selectIndex = item.id; // 动态class
      this.accountParams.startAccountCode = item.code;
      this.accountParams.endAccountCode = item.code;
      this.detailAccountInit(this.accountParams); // 列表
      document.querySelector(
        ".detail-account-box .el-table__body-wrapper"
      ).scrollTop = 0; // 搜索设置滚动条距离
    },
    formatPeriod(data) {
      var dateReg = /^(\d{4})-(\d{2})-(\d{2})$/;
      if (dateReg.test(data.start)) {
      } else {
        data.start = this.formatDate(data.start);
        data.end = this.formatDate(data.start);
      }
      // 期间格式化
      let formatStart = data.start.slice(0, 7).split("-").join("年");
      let formatEnd = data.end.slice(0, 7).split("-").join("年");
      if (formatStart === formatEnd) {
        this.periodContent = `${formatStart}期`;
      } else {
        this.periodContent = `${formatStart}期 至 ${formatEnd}期`;
      }
      this.currentPeriodObj.startCurren = data.start;
      this.currentPeriodObj.endCurren = data.end;
    },
    searchList(query, codeNameData) {
      sessionStorage.setItem('DetailAccountPageSearch', JSON.stringify(query))

      let data = {...query, ...codeNameData}
      delete data.dateRange;
      // 根据期间相关搜索
      this.formTiem.dateRange = query.dateRange;
      this.$refs.accountBook.changeData(this.formTiem.dateRange)
      this.periodDataSch.start = data.start;
      this.periodDataSch.end = data.end;
      this.accountParams.start = this.formatDate(data.start);
      this.accountParams.end = this.formatDate(data.end);
      this.accountParams = data; // 获取数据
      this.formatPeriod(data); // 格式化期间
      this.subjectList('seach'); // 右侧科目列表
      this.codeNameProps = codeNameData; // 级次数据
      this.accountBookPopupShow = false;
      this.$refs.dateSelection.uncheck();
      // this.detailAccountInit(data)
      document.querySelector(
        ".detail-account-box .el-table__body-wrapper"
      ).scrollTop = 0; // 搜索设置滚动条距离
    },
    datePeriod() {
      // 期间弹框
      this.accountBookPopupShow = !this.accountBookPopupShow;
    },
    printBtn() {
      console.log(this.accountParams);
      let query = {...this.accountParams};
      delete query.startAccountCode;
      delete query.endAccountCode;
      delete query.dateRange;
      // 打印
      printExport(
        "/account-book/export-subsidiary-ledger",
        "print-pdf",
        "",
        query
      );
    },
    exportBtn() {
      let query = {...this.accountParams};
      // delete query.startAccountCode;
      // delete query.endAccountCode;
      // delete query.dateRange;
      // // 导出
      printExport(
        "/account-book/export-subsidiary-ledger",
        "excel",
        "",
        query
      );
    },
    batchExportBtn() {
      // 批量导出弹框
      this.batchExportShow = true;
    },
    submitBatchBtn(data, formatType, uploadType) {
      let period = {...this.accountParams};
      this.formatDate(new Date(this.formTiem.start))
      period.startPeriod = this.formatDate(data.start).replaceAll("-", "");
      period.endPeriod = this.formatDate(data.end).replaceAll("-", "");
      period.startPeriod = period.startPeriod.slice(0, 6);
      period.endPeriod = period.endPeriod.slice(0, 6);
      delete period.accountId;
      if(this.accountParams.endAccountCode){
        period.endAccountCode = this.accountParams.endAccountCode;
      }
      if(this.accountParams.startAccountCode){
        period.startAccountCode = this.accountParams.startAccountCode;
      }
      if(uploadType == '0'){//单个
        period.isAll = '0';
        // 批量导出数据
        printExport(
          "/account-book/batch-export-subsidiary-ledger",
          formatType,
          "",
          period
        );
      }else {//批量
        period.isAll = '1';
        // 批量导出数据
        printExport(
          "/account-book/batch-export-subsidiary-ledger",
          formatType,
          "",
          period
        );
      }
      this.batchExportShow = false;


    },
    closeModel() {
      this.batchExportShow = false;
    },
    handleClose() {
      this.accountBookPopupShow = !this.accountBookPopupShow;
    },
  },
  watch: {
    $route(to, from) {
      if(to.name == "detailAccount"){
        // this.formTiem.dateRange = [to.params.period.start,to.params.period.end];
        if (to.query && to.query.subjectId) {
          setTimeout(() => {
            this.clickSubjectIdFlag = "clickSubjcet";
            this.subjectCodeName = to.query.code + " " + to.query.fullName;
            this.$refs.accountBook.setSubjectCode(to.query.code)
            this.accountParams.endAccountCode = to.query.code;
            this.accountParams.startAccountCode = to.query.code;
            this.accountParams.accountId = Number(to.query.subjectId); // 获取对应id
            this.selectIndex = to.query.subjectId; // 动态class
          }, 100);
        }else if(this.$route.params.code){
          // 科目余额表跳转明细表
          this.$refs.accountBook.setSubjectCode(this.$route.params.code)
          this.accountParams.endAccountCode = this.$route.params.code;
          this.accountParams.startAccountCode = this.$route.params.code;
        }
      }
      if (
        to.name === "detailAccount" &&
        (from.name === "voucherInfo" || from.name === "voucherInput")
      ) {
        if (to.query && to.query.subjectId) {
          setTimeout(() => {
            this.clickSubjectIdFlag = "clickSubjcet";
            this.subjectCodeName = to.query.code + " " + to.query.fullName;
            this.$refs.accountBook.setSubjectCode(to.query.code)
            this.accountParams.endAccountCode = to.query.code;
            this.accountParams.startAccountCode = to.query.code;
            this.accountParams.accountId = Number(to.query.subjectId); // 获取对应id
            this.selectIndex = to.query.subjectId; // 动态class
            this.accountParams.start = to.query.date;
            this.accountParams.end = to.query.date;
            this.periodContent =
              to.query.date.slice(0, 7).split("-").join("年") + "期";
            this.currentPeriodObj.startCurren = to.query.date;
            this.currentPeriodObj.endCurren = to.query.date;
            this.detailAccountInit(this.accountParams); // 列表
          }, 100);
        }
      }
      // 监听路由变化，获取表格滚动到的位置
      if(to.fullPath == '/center/detailAccount') {
        let position = sessionStorage.getItem('DetailAccountPagePosition')
        this.$nextTick(() => {
          this.$refs.mainTable.bodyWrapper.scrollTop = position
        })
        this.$nextTick(() => {
          this.$refs.mainTable.bodyWrapper.addEventListener('scroll',() => {
            if(this.$refs.mainTable.bodyWrapper.scrollTop) {
              sessionStorage.setItem('DetailAccountPagePosition', this.$refs.mainTable.bodyWrapper.scrollTop)
            }
          })
        })
      }
      if(from.fullPath == '/center/detailAccount') {
        this.$refs.mainTable.bodyWrapper.addEventListener('scroll', null)
      }
    },
    detailAccountList() {
      // 数据发生改变后，将表格位置重置为缓存保存的位置
      let position = sessionStorage.getItem('DetailAccountPagePosition')
      this.$nextTick(() => {
        this.$refs.mainTable.bodyWrapper.scrollTop = position
      })
    },
    refreshPage(newVal, oldVal) {
      if (newVal === "detailAccount") {
        if (sessionStorage.listStatus) {
          let newStatus = JSON.parse(sessionStorage.listStatus);
          if (
            newStatus.detailAccount === 1 ||
            newStatus.detailAccount === "1"
          ) {
            this.periodListFn("load");
          } else {
            this.periodListFn("tabClick");
          }
        } else {
          this.periodListFn("tabClick");
        }
      }
    },
    accountBookPopupShow: function (val) {
      if (val) {
        document.addEventListener("keydown", (event) => {
          if (event.keyCode === 13 && this.$refs.accountBook) {
            //明细账页面取消监听回车查询功能。解决录入凭证卡顿问题
            //this.$refs.accountBook.seachForm();
          }
        });
      }
    },
    accountParams: function (val) {
      if (val.showZeroNoOccur) {
        this.periodData.showZeroNoOccur = true;
      } else {
        this.periodData.showZeroNoOccur = false;
      }
    },
    subjectInput: {
      handler: function (newVal, oldVal) {
        if (newVal) {
          var arrSub = [];
          this.searchSubjectArray.map((item, key) => {
            if (item.code.indexOf(newVal) >= 0) {
              arrSub.push(item);
            } else if (item.name.indexOf(newVal) >= 0) {
              arrSub.push(item);
            } else if (item.pinyin.indexOf(newVal) >= 0) {
              arrSub.push(item);
            }
          });
          this.subjectArray = arrSub;
        } else {
          this.subjectArray = this.searchSubjectArray;
        }
      },
    },
  },
  components: {
    accountBookPopup,
    batchExportCom,
    dateSelection,
    vPagination
  },
};
</script>

<style lang="less" scoped>
@import "../../../../style/base.less";
.main-top {
  padding-left: 16px;
  .btn-group {
    float: right;
    margin-right: 16px;
    button + button {
      margin-left: 10px;
    }
  }
}
.seach-box{
  width: 400px !important;
  overflow: hidden;
}
.detail-account-box {
  background: transparent;
  .detail_account_head {
    border-radius: 4px;
    margin-bottom: 20px;
    box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.08);
  }
  .main-content {
    display: flex;
    flex-direction: column;
    padding-top: 20px;
    margin: 0;
    .btn-group {
      padding: 0 20px;
      margin-bottom: 20px;
    }
    background: #ffffff;
  }
}

.detail_account_main {
  // display: grid;
  // grid-template-columns: 1fr 19%;
  // grid-template-rows: 1fr;
  // column-gap: 14px;
  display: flex;
  flex-direction:row;
  height: calc(100% - 100px);
}
.main-content .table-main {
  // width: 100%;
  .active {
    color: #5478fb;
    cursor: pointer;
    &:hover {
      text-decoration: none;
    }
  }
}
.main-subject .main-content .table-main{
  width: 80%;
}
.subject-content {
  flex-basis: 300px;
  display: flex;
  flex-direction: column;
  width: 20%;
  min-width: 270px;
  margin: 0;
  border: 1px solid #f0f0f0;
  overflow: scroll;
  .subject-header {
    padding: 15px 10px 0;
    p {
      font-size: 14px;
      color: #333;
    }
    .subject-input {
      margin: 10px 0;
    }
  }
  .subject-item {
    overflow: auto;
    li {
      padding-left: 14px;
      line-height: 30px;
      color: #333;
      cursor: pointer;
      &.active {
        background: #f4f7fa;
      }
    }
  }
}
.table-main .code-active {
  color: #5478fb;
  cursor: pointer;
  &:hover {
    text-decoration: underline;
  }
}
.main-subject .customer-box {
  padding-right: 0 !important;
}
.main-content.customer-box {
  flex-direction: column;
  .table-main {
    height: 100%;
    padding-right: 20px;
    margin-bottom: 0;
    padding-bottom: 20px;
    .redColor {
      color: #ff6666;
    }
    .periodTable {
      // padding-top: 68px;
      // padding-bottom: 35px;
    }
  }
  .page-box {
    margin: 15px 16px 20px 16px;
  }
}
/deep/.el-table td.el-table__cell div {
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
    display: block !important;
}

.float-left{
  float: left;
}
</style>
<style lang="less">
.sumBalance .table-main .el-table__body-wrapper {
  // height: 100%;
  // overflow-y: auto;
}
.sumBalance_search__group {
  display: grid;
  grid-template-columns: 1fr;
  grid-template-rows: auto;
  margin-bottom: 20px;
  padding: 24px 16px 24px 25px;
  background: #fff;
  width: 100%;
  border-radius: 4px;
  box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.08);
  .el-icon-refresh-salf {
    margin-top: 0;
    margin-left: 15px;
  }
}
.sumBalance_content {
  background: #fff;
  border-radius: 4px;
  box-shadow: 0 0 8px 0 rgba(0, 0, 0, 0.08);
  padding-bottom: 0;
  height: calc(100% - 10px);
}
.table-main-cell .el-table .el-table-column--selection .cell{
  padding: 0 !important;
}
.table-main-cell .el-table .is-left .cell{
  justify-content: left !important;
}
.table-main-balance .el-table__body tr.el-table__row--striped td.el-table__cell{
  padding: 5px;
}
.table-main-balance .el-table__body td.el-table__cell{
  padding: 5px;
}
.table-main-balance  tbody td.el-table__cell{
  padding: 5px;
}
.table-main-balance .main-content .table-main .el-table th{
  padding: 5px;
}
.main-subject .main-content .table-main .el-table th{
  padding: 5px !important;
}
.main-subject .el-table__footer-wrapper{
  position: absolute;
  bottom: 0;
  }
.main-subject button.el-button {
  padding: 6px 5px !important;
}
.main-subject .blueHeaderTable.el-table.el-table--striped{
  position: relative;
}
.main-subject .main-top{
  padding: 5px 20px !important;
}

</style>
```



